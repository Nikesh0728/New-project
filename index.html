<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DIGI POST - Professional Parcel Delivery Service</title>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #f1f3f6;
            min-height: 100%;
            line-height: 1.6;
        }

        html {
            height: 100%;
        }

        * {
            box-sizing: border-box;
        }

        /* Header Styles */
        .header {
            background: #2874f0;
            color: white;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-top {
            background: #2874f0;
            padding: 8px 0;
            font-size: 12px;
            text-align: center;
        }

        .header-main {
            padding: 8px 0;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 20px;
            font-weight: bold;
            text-decoration: none;
            color: white;
        }

        .logo-icon {
            font-size: 24px;
        }

        .search-container {
            flex: 1;
            max-width: 500px;
            margin: 0 20px;
            position: relative;
        }

        .search-box {
            width: 100%;
            padding: 10px 16px;
            border: none;
            border-radius: 2px;
            font-size: 14px;
            outline: none;
        }

        .search-btn {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            background: #fff;
            border: none;
            padding: 0 16px;
            cursor: pointer;
            color: #2874f0;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .header-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 2px;
            transition: background-color 0.2s;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .header-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .user-menu {
            position: relative;
        }

        .dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 4px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            min-width: 200px;
            display: none;
            z-index: 1001;
        }

        .dropdown.show {
            display: block;
        }

        .dropdown-item {
            display: block;
            padding: 12px 16px;
            color: #212121;
            text-decoration: none;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
        }

        .dropdown-item:hover {
            background: #f8f8f8;
        }

        /* Navigation */
        .nav-bar {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 0;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
        }

        .nav-item {
            padding: 16px 20px;
            color: #212121;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .nav-item:hover, .nav-item.active {
            color: #2874f0;
            border-bottom-color: #2874f0;
        }

        /* Main Content */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 16px;
        }

        .page {
            display: none;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .page.active {
            display: block;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #2874f0 0%, #1e5bb8 100%);
            color: white;
            padding: 60px 40px;
            text-align: center;
        }

        .hero h1 {
            font-size: 48px;
            font-weight: 300;
            margin: 0 0 16px 0;
        }

        .hero p {
            font-size: 18px;
            margin: 0 0 32px 0;
            opacity: 0.9;
        }

        .cta-button {
            background: #ff6161;
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .cta-button:hover {
            background: #e55555;
        }

        /* Features Grid */
        .features-section {
            padding: 60px 40px;
        }

        .section-title {
            text-align: center;
            font-size: 32px;
            font-weight: 300;
            color: #212121;
            margin: 0 0 48px 0;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 32px;
        }

        .feature-card {
            text-align: center;
            padding: 32px 24px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }

        .feature-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .feature-card h3 {
            font-size: 20px;
            font-weight: 500;
            color: #212121;
            margin: 0 0 12px 0;
        }

        .feature-card p {
            color: #696969;
            margin: 0;
        }

        /* Form Styles */
        .form-container {
            max-width: 480px;
            margin: 0 auto;
            padding: 40px;
        }

        .form-title {
            text-align: center;
            font-size: 24px;
            font-weight: 400;
            color: #212121;
            margin: 0 0 32px 0;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #212121;
            font-size: 14px;
            font-weight: 500;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.2s;
            background: white;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #2874f0;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: #2874f0;
            color: white;
        }

        .btn-primary:hover {
            background: #1e5bb8;
        }

        .btn-secondary {
            background: white;
            color: #2874f0;
            border: 1px solid #2874f0;
        }

        .btn-secondary:hover {
            background: #f8f9fa;
        }

        .btn-success {
            background: #388e3c;
            color: white;
        }

        .btn-success:hover {
            background: #2e7d32;
        }

        .btn-full {
            width: 100%;
        }

        /* Dashboard */
        .dashboard-header {
            background: linear-gradient(135deg, #2874f0 0%, #1e5bb8 100%);
            color: white;
            padding: 32px 40px;
        }

        .dashboard-title {
            font-size: 28px;
            font-weight: 300;
            margin: 0 0 8px 0;
        }

        .dashboard-subtitle {
            opacity: 0.9;
            margin: 0;
        }

        .dashboard-content {
            padding: 40px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 32px;
            font-weight: 300;
            color: #2874f0;
            margin: 0 0 8px 0;
        }

        .stat-label {
            color: #696969;
            font-size: 14px;
            margin: 0;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
        }

        .action-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .action-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .action-icon {
            font-size: 32px;
            margin-bottom: 16px;
        }

        .action-title {
            font-size: 16px;
            font-weight: 500;
            color: #212121;
            margin: 0 0 8px 0;
        }

        .action-desc {
            color: #696969;
            font-size: 14px;
            margin: 0;
        }

        /* Tracking Results */
        .tracking-result {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 24px;
            margin-top: 24px;
        }

        .tracking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e0e0e0;
        }

        .tracking-id {
            font-size: 18px;
            font-weight: 500;
            color: #212121;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-processing {
            background: #fff3cd;
            color: #856404;
        }

        .status-transit {
            background: #cce5ff;
            color: #0066cc;
        }

        .status-delivered {
            background: #d4edda;
            color: #155724;
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 32px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 12px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e0e0e0;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 32px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -38px;
            top: 4px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e0e0e0;
            border: 3px solid white;
            box-shadow: 0 0 0 1px #e0e0e0;
        }

        .timeline-item.completed::before {
            background: #388e3c;
            box-shadow: 0 0 0 1px #388e3c;
        }

        .timeline-item.active::before {
            background: #2874f0;
            box-shadow: 0 0 0 1px #2874f0;
        }

        .timeline-title {
            font-weight: 500;
            color: #212121;
            margin: 0 0 4px 0;
        }

        .timeline-time {
            color: #696969;
            font-size: 14px;
            margin: 0;
        }

        /* Payment Methods */
        .payment-summary {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .payment-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .payment-total {
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            font-weight: 500;
            color: #212121;
            padding-top: 16px;
            border-top: 1px solid #e0e0e0;
        }

        .payment-method {
            display: none;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 24px;
            margin-top: 24px;
        }

        .payment-method.active {
            display: block;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            background: white;
            border: 2px solid #2874f0;
            border-radius: 8px;
            margin: 16px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .qr-icon {
            font-size: 48px;
            color: #2874f0;
            margin-bottom: 8px;
        }

        /* Chatbot */
        .chat-toggle {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            background: #2874f0;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(40, 116, 240, 0.3);
            z-index: 999;
            transition: transform 0.2s;
        }

        .chat-toggle:hover {
            transform: scale(1.1);
        }

        .chatbot {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 360px;
            height: 480px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            display: none;
            flex-direction: column;
            z-index: 1000;
            overflow: hidden;
        }

        .chatbot.show {
            display: flex;
        }

        .chatbot-header {
            background: #2874f0;
            color: white;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-title {
            font-weight: 500;
        }

        .chatbot-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chatbot-messages {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .chatbot-input {
            padding: 16px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 8px;
            background: white;
        }

        .chat-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            outline: none;
        }

        .chat-send {
            background: #2874f0;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 12px;
        }

        .message {
            margin-bottom: 16px;
            max-width: 80%;
        }

        .message.user {
            margin-left: auto;
        }

        .message-content {
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.4;
        }

        .message.user .message-content {
            background: #2874f0;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.bot .message-content {
            background: white;
            color: #212121;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 4px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 12px;
            }

            .search-container {
                order: 3;
                margin: 0;
                max-width: none;
            }

            .nav-container {
                overflow-x: auto;
                white-space: nowrap;
            }

            .hero {
                padding: 40px 20px;
            }

            .hero h1 {
                font-size: 32px;
            }

            .features-section {
                padding: 40px 20px;
            }

            .form-container {
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .dashboard-content {
                padding: 20px;
            }

            .chatbot {
                width: calc(100vw - 32px);
                height: 400px;
                right: 16px;
                bottom: 16px;
            }

            .chat-toggle {
                right: 16px;
                bottom: 16px;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Admin Styles */
        .admin-tab {
            background: none;
            border: none;
            padding: 12px 24px;
            color: #696969;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .admin-tab:hover {
            color: #2874f0;
        }

        .admin-tab.active {
            color: #2874f0;
            border-bottom-color: #2874f0;
        }

        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
        }

        .parcel-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            background: white;
            transition: box-shadow 0.2s;
        }

        .parcel-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .user-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            background: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .query-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            background: white;
        }

        .query-card.pending {
            border-left: 4px solid #ff9800;
        }

        .query-card.resolved {
            border-left: 4px solid #4caf50;
        }

        /* QR Scanner Animations */
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        @keyframes scanLine {
            0% { top: 0; }
            100% { top: 100%; }
        }

        .scanner-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #ff6161, transparent);
            animation: scanLine 2s linear infinite;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body><!-- Header -->
  <header class="header">
   <div class="header-top">
    üìû Customer Support: 1800-DIGI-POST | üöö Free delivery across Tamil Nadu
   </div>
   <div class="header-main">
    <div class="header-container"><a href="#" class="logo" onclick="showPage('home')"> <span class="logo-icon">üì¶</span> <span>DIGI POST</span> </a>
     <div class="search-container"><input type="text" class="search-box" id="globalSearch" placeholder="Search for parcels, tracking numbers..." onkeyup="handleGlobalSearch(event)" autocomplete="off"> <button class="search-btn" onclick="performGlobalSearch()">üîç</button>
      <div class="search-results" id="searchResults" style="
                        position: absolute;
                        top: 100%;
                        left: 0;
                        right: 0;
                        background: white;
                        border-radius: 0 0 4px 4px;
                        box-shadow: 0 4px 16px rgba(0,0,0,0.2);
                        max-height: 300px;
                        overflow-y: auto;
                        display: none;
                        z-index: 1002;
                    "></div>
     </div>
     <div class="header-actions">
      <div class="user-menu"><button class="header-btn" id="userMenuBtn" onclick="toggleUserMenu()"> <span>üë§</span> <span id="userMenuText">Account</span> </button>
       <div class="dropdown" id="userDropdown"><a href="#" class="dropdown-item" id="loginLink" onclick="showPage('login')">Login</a> <a href="#" class="dropdown-item" id="signupLink" onclick="showPage('signup')">Sign Up</a> <a href="#" class="dropdown-item hidden" id="dashboardLink" onclick="showPage('dashboard')">Dashboard</a> <a href="#" class="dropdown-item hidden" id="profileLink">My Profile</a> <a href="#" class="dropdown-item hidden" id="logoutLink" onclick="logout()">Logout</a> <a href="#" class="dropdown-item" id="adminLoginLink" onclick="showPage('adminLogin')" style="border-top: 1px solid #f0f0f0; color: #ff6161;">üîê Admin Login</a>
       </div>
      </div><button class="header-btn" onclick="showPage('tracking')"> <span>üìç</span> <span>Track</span> </button>
     </div>
    </div>
   </div>
  </header><!-- Navigation -->
  <nav class="nav-bar">
   <div class="nav-container"><a href="#" class="nav-item active" onclick="showPage('home')">Home</a> <a href="#" class="nav-item" onclick="showPage('booking')">Book Parcel</a> <a href="#" class="nav-item" onclick="showPage('tracking')">Track Parcel</a> <a href="#" class="nav-item" onclick="showPage('delivery')">Delivery Status</a> <a href="#" class="nav-item" onclick="showPage('payment')">Pay Bills</a> <a href="#" class="nav-item" onclick="showPage('customerQuery')">Report Issue</a>
   </div>
  </nav><!-- Main Content -->
  <main class="main-container"><!-- Home Page -->
   <div id="home" class="page active">
    <div class="hero">
     <div style="display: flex; align-items: center; justify-content: center; gap: 40px; flex-wrap: wrap;">
      <div style="flex: 1; min-width: 300px;">
       <h1>Fast Post Office Service</h1>
       <p>Connecting Tamil Nadu with lightning-fast delivery and modern postal solutions</p><button class="cta-button" onclick="showPage('signup')">Start Shipping Today</button>
      </div>
      <div style="flex: 1; min-width: 300px; text-align: center;">
       <svg width="280" height="200" viewbox="0 0 280 200" style="max-width: 100%; height: auto;"><!-- Delivery truck --> <rect x="40" y="120" width="80" height="40" fill="#2874f0" rx="5" /> <rect x="45" y="125" width="70" height="30" fill="#1e5bb8" rx="3" /> <circle cx="60" cy="170" r="12" fill="#333" /> <circle cx="100" cy="170" r="12" fill="#333" /> <circle cx="60" cy="170" r="8" fill="#666" /> <circle cx="100" cy="170" r="8" fill="#666" /> <!-- Cargo area --> <rect x="120" y="110" width="60" height="50" fill="#ff6161" rx="5" /> <rect x="125" y="115" width="50" height="40" fill="#e55555" rx="3" /> <circle cx="140" cy="170" r="12" fill="#333" /> <circle cx="160" cy="170" r="12" fill="#333" /> <circle cx="140" cy="170" r="8" fill="#666" /> <circle cx="160" cy="170" r="8" fill="#666" /> <!-- Packages --> <rect x="130" y="125" width="15" height="15" fill="#fff" rx="2" /> <rect x="150" y="125" width="15" height="15" fill="#fff" rx="2" /> <rect x="140" y="140" width="15" height="15" fill="#fff" rx="2" /> <!-- Speed lines --> <line x1="10" y1="130" x2="30" y2="130" stroke="#fff" stroke-width="3" opacity="0.7" /> <line x1="15" y1="140" x2="35" y2="140" stroke="#fff" stroke-width="2" opacity="0.5" /> <line x1="5" y1="150" x2="25" y2="150" stroke="#fff" stroke-width="2" opacity="0.5" /> <!-- Buildings in background --> <rect x="200" y="80" width="25" height="80" fill="#4a90e2" opacity="0.3" /> <rect x="230" y="60" width="20" height="100" fill="#4a90e2" opacity="0.3" /> <rect x="255" y="90" width="20" height="70" fill="#4a90e2" opacity="0.3" /> <!-- Road --> <rect x="0" y="180" width="280" height="20" fill="#555" /> <rect x="0" y="188" width="280" height="2" fill="#fff" opacity="0.5" />
       </svg>
      </div>
     </div>
    </div>
    <div class="features-section">
     <h2 class="section-title">Why Choose DIGI POST?</h2>
     <div class="features-grid">
      <div class="feature-card">
       <div class="feature-icon">
        <svg width="48" height="48" viewbox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="20" fill="#2874f0" opacity="0.1" /> <path d="M16 20L24 14L32 20V32C32 33.1 31.1 34 30 34H18C16.9 34 16 33.1 16 32V20Z" fill="#2874f0" /> <path d="M20 28H28V32H20V28Z" fill="#fff" /> <circle cx="22" cy="30" r="1" fill="#2874f0" /> <circle cx="26" cy="30" r="1" fill="#2874f0" />
        </svg>
       </div>
       <h3>Lightning Fast Delivery</h3>
       <p>Same-day delivery available in major cities. Express delivery in 1-2 days across Tamil Nadu.</p>
      </div>
      <div class="feature-card">
       <div class="feature-icon">
        <svg width="48" height="48" viewbox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="20" fill="#ff6161" opacity="0.1" /> <rect x="14" y="16" width="20" height="16" rx="2" fill="#ff6161" /> <circle cx="24" cy="24" r="6" fill="#fff" /> <circle cx="24" cy="24" r="2" fill="#ff6161" /> <path d="M30 18L34 22L30 26" stroke="#ff6161" stroke-width="2" fill="none" />
        </svg>
       </div>
       <h3>Real-time Tracking</h3>
       <p>Track your parcels in real-time with detailed status updates and delivery notifications.</p>
      </div>
      <div class="feature-card">
       <div class="feature-icon">
        <svg width="48" height="48" viewbox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="20" fill="#388e3c" opacity="0.1" /> <rect x="16" y="18" width="16" height="12" rx="2" fill="#388e3c" /> <circle cx="24" cy="24" r="3" fill="#fff" /> <path d="M22 24L23 25L26 22" stroke="#388e3c" stroke-width="2" fill="none" />
        </svg>
       </div>
       <h3>Secure &amp; Safe</h3>
       <p>Your parcels are insured and handled with utmost care. 100% secure payment gateway.</p>
      </div>
      <div class="feature-card">
       <div class="feature-icon">
        <svg width="48" height="48" viewbox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="20" fill="#ff9800" opacity="0.1" /> <circle cx="24" cy="24" r="8" fill="#ff9800" /> <path d="M24 18V24L28 28" stroke="#fff" stroke-width="2" fill="none" /> <text x="24" y="38" text-anchor="middle" fill="#ff9800" font-size="8">
          üí∞
         </text>
        </svg>
       </div>
       <h3>Best Prices</h3>
       <p>Competitive pricing with no hidden charges. Multiple payment options including QR codes.</p>
      </div>
      <div class="feature-card">
       <div class="feature-icon">
        <svg width="48" height="48" viewbox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="20" fill="#9c27b0" opacity="0.1" /> <circle cx="24" cy="20" r="6" fill="#9c27b0" /> <circle cx="22" cy="18" r="1" fill="#fff" /> <circle cx="26" cy="18" r="1" fill="#fff" /> <path d="M20 22C20 22 22 24 24 24C26 24 28 22 28 22" stroke="#fff" stroke-width="1.5" fill="none" /> <rect x="18" y="28" width="12" height="6" rx="1" fill="#9c27b0" />
        </svg>
       </div>
       <h3>24/7 AI Support</h3>
       <p>Get instant help with our intelligent chatbot. Human support available when needed.</p>
      </div>
      <div class="feature-card">
       <div class="feature-icon">
        <svg width="48" height="48" viewbox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="20" fill="#607d8b" opacity="0.1" /> <circle cx="24" cy="24" r="10" stroke="#607d8b" stroke-width="2" fill="none" /> <circle cx="24" cy="24" r="2" fill="#607d8b" /> <path d="M24 14V18M34 24H30M24 34V30M14 24H18" stroke="#607d8b" stroke-width="2" /> <circle cx="18" cy="18" r="1" fill="#607d8b" /> <circle cx="30" cy="18" r="1" fill="#607d8b" /> <circle cx="30" cy="30" r="1" fill="#607d8b" /> <circle cx="18" cy="30" r="1" fill="#607d8b" />
        </svg>
       </div>
       <h3>Wide Coverage</h3>
       <p>Serving all major cities and towns across Tamil Nadu with expanding network.</p>
      </div>
     </div>
    </div>
   </div><!-- Login Page -->
   <div id="login" class="page">
    <div class="form-container">
     <h2 class="form-title">Welcome Back</h2>
     <form id="loginForm" onsubmit="handleLogin(event)">
      <div class="form-group"><label for="loginEmail" class="form-label">Email Address</label> <input type="email" id="loginEmail" name="email" class="form-input" required>
      </div>
      <div class="form-group"><label for="loginPassword" class="form-label">Password</label> <input type="password" id="loginPassword" name="password" class="form-input" required>
      </div><button type="submit" class="btn btn-primary btn-full">Login to Your Account</button>
     </form>
     <p style="text-align: center; margin-top: 24px; color: #696969;">New to DIGI POST? <a href="#" onclick="showPage('signup')" style="color: #2874f0; text-decoration: none;">Create an account</a></p>
    </div>
   </div><!-- Signup Page -->
   <div id="signup" class="page">
    <div class="form-container">
     <h2 class="form-title">Create Your Account</h2>
     <form id="signupForm" onsubmit="handleSignup(event)">
      <div class="form-group"><label for="signupName" class="form-label">Full Name</label> <input type="text" id="signupName" name="name" class="form-input" required>
      </div>
      <div class="form-row">
       <div class="form-group"><label for="signupEmail" class="form-label">Email Address</label> <input type="email" id="signupEmail" name="email" class="form-input" required>
       </div>
       <div class="form-group"><label for="signupPhone" class="form-label">Phone Number</label> <input type="tel" id="signupPhone" name="phone" class="form-input" required>
       </div>
      </div>
      <div class="form-row">
       <div class="form-group"><label for="signupCity" class="form-label">City</label> <select id="signupCity" name="city" class="form-select" required> <option value="">Select Your City</option> <option value="Chennai">Chennai</option> <option value="Coimbatore">Coimbatore</option> <option value="Madurai">Madurai</option> <option value="Tiruchirappalli">Tiruchirappalli</option> <option value="Salem">Salem</option> <option value="Tirunelveli">Tirunelveli</option> <option value="Erode">Erode</option> <option value="Vellore">Vellore</option> <option value="Thoothukudi">Thoothukudi</option> <option value="Dindigul">Dindigul</option> </select>
       </div>
       <div class="form-group"><label for="signupPassword" class="form-label">Password</label> <input type="password" id="signupPassword" name="password" class="form-input" required>
       </div>
      </div><button type="submit" class="btn btn-primary btn-full">Create Account</button>
     </form>
     <p style="text-align: center; margin-top: 24px; color: #696969;">Already have an account? <a href="#" onclick="showPage('login')" style="color: #2874f0; text-decoration: none;">Sign in here</a></p>
    </div>
   </div><!-- Dashboard Page -->
   <div id="dashboard" class="page">
    <div class="dashboard-header">
     <h1 class="dashboard-title">Welcome back</h1>
     <p class="dashboard-subtitle">Manage your parcels and deliveries</p>
    </div>
    <div class="dashboard-content">
     <div class="stats-grid">
      <div class="stat-card">
       <div class="stat-number" id="totalParcels">
        12
       </div>
       <div class="stat-label">
        Total Parcels
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-number" id="activeDeliveries">
        3
       </div>
       <div class="stat-label">
        Active Deliveries
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-number" id="deliveredParcels">
        9
       </div>
       <div class="stat-label">
        Delivered
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-number">
        ‚Çπ2,450
       </div>
       <div class="stat-label">
        Total Spent
       </div>
      </div>
     </div>
     <div class="quick-actions">
      <div class="action-card" onclick="showPage('booking')">
       <div class="action-icon">
        üì¶
       </div>
       <div class="action-title">
        Book New Parcel
       </div>
       <div class="action-desc">
        Send parcels across Tamil Nadu
       </div>
      </div>
      <div class="action-card" onclick="showPage('tracking')">
       <div class="action-icon">
        üîç
       </div>
       <div class="action-title">
        Track Parcels
       </div>
       <div class="action-desc">
        Real-time tracking updates
       </div>
      </div>
      <div class="action-card" onclick="showPage('priceCalculator')">
       <div class="action-icon">
        üí∞
       </div>
       <div class="action-title">
        Price Calculator
       </div>
       <div class="action-desc">
        Estimate shipping costs
       </div>
      </div>
      <div class="action-card" onclick="showPage('bulkBooking')">
       <div class="action-icon">
        üì¶
       </div>
       <div class="action-title">
        Bulk Booking
       </div>
       <div class="action-desc">
        Book multiple parcels
       </div>
      </div>
      <div class="action-card" onclick="showPage('analytics')">
       <div class="action-icon">
        üìä
       </div>
       <div class="action-title">
        Analytics
       </div>
       <div class="action-desc">
        View shipping statistics
       </div>
      </div>
      <div class="action-card" onclick="showPage('savedAddresses')">
       <div class="action-icon">
        üìç
       </div>
       <div class="action-title">
        Saved Addresses
       </div>
       <div class="action-desc">
        Manage your addresses
       </div>
      </div>
      <div class="action-card" onclick="showPage('insurance')">
       <div class="action-icon">
        üõ°Ô∏è
       </div>
       <div class="action-title">
        Insurance
       </div>
       <div class="action-desc">
        Protect your shipments
       </div>
      </div>
      <div class="action-card" onclick="showPage('liveSupport')">
       <div class="action-icon">
        üí¨
       </div>
       <div class="action-title">
        Live Support
       </div>
       <div class="action-desc">
        Chat with support team
       </div>
      </div>
      <div class="action-card" onclick="showPage('myQueries')">
       <div class="action-icon">
        üìã
       </div>
       <div class="action-title">
        My Queries
       </div>
       <div class="action-desc">
        View submitted queries
       </div>
      </div>
      <div class="action-card" onclick="showPage('paymentHistory')">
       <div class="action-icon">
        üí≥
       </div>
       <div class="action-title">
        Payment History
       </div>
       <div class="action-desc">
        View all transactions
       </div>
      </div>
      <div class="action-card" onclick="showPage('profile')">
       <div class="action-icon">
        üë§
       </div>
       <div class="action-title">
        My Profile
       </div>
       <div class="action-desc">
        Edit profile &amp; settings
       </div>
      </div>
     </div>
    </div>
   </div><!-- Booking Page -->
   <div id="booking" class="page">
    <div class="form-container" style="max-width: 800px;">
     <h2 class="form-title">üì¶ Book a New Parcel</h2>
     <form id="bookingForm" onsubmit="handleBooking(event)">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;"><!-- Sender Details -->
       <div>
        <h3 style="color: #212121; margin-bottom: 20px; font-weight: 500;">Sender Details</h3>
        <div class="form-group"><label for="senderName" class="form-label">Full Name</label> <input type="text" id="senderName" name="senderName" class="form-input" required>
        </div>
        <div class="form-group"><label for="senderPhone" class="form-label">Phone Number</label> <input type="tel" id="senderPhone" name="senderPhone" class="form-input" required>
        </div>
        <div class="form-group"><label for="senderAddress" class="form-label">Pickup Address</label> <textarea id="senderAddress" name="senderAddress" class="form-textarea" required></textarea>
        </div>
        <div class="form-group"><label for="senderCity" class="form-label">Pickup City</label> <select id="senderCity" name="senderCity" class="form-select" required> <option value="">Select City</option> <option value="Chennai">Chennai</option> <option value="Coimbatore">Coimbatore</option> <option value="Madurai">Madurai</option> <option value="Tiruchirappalli">Tiruchirappalli</option> <option value="Salem">Salem</option> <option value="Tirunelveli">Tirunelveli</option> <option value="Erode">Erode</option> <option value="Vellore">Vellore</option> <option value="Thoothukudi">Thoothukudi</option> <option value="Dindigul">Dindigul</option> </select>
        </div>
       </div><!-- Receiver Details -->
       <div>
        <h3 style="color: #212121; margin-bottom: 20px; font-weight: 500;">Receiver Details</h3>
        <div class="form-group"><label for="receiverName" class="form-label">Full Name</label> <input type="text" id="receiverName" name="receiverName" class="form-input" required>
        </div>
        <div class="form-group"><label for="receiverPhone" class="form-label">Phone Number</label> <input type="tel" id="receiverPhone" name="receiverPhone" class="form-input" required>
        </div>
        <div class="form-group"><label for="receiverAddress" class="form-label">Delivery Address</label> <textarea id="receiverAddress" name="receiverAddress" class="form-textarea" required></textarea>
        </div>
        <div class="form-group"><label for="receiverCity" class="form-label">Delivery City</label> <select id="receiverCity" name="receiverCity" class="form-select" required> <option value="">Select City</option> <option value="Chennai">Chennai</option> <option value="Coimbatore">Coimbatore</option> <option value="Madurai">Madurai</option> <option value="Tiruchirappalli">Tiruchirappalli</option> <option value="Salem">Salem</option> <option value="Tirunelveli">Tirunelveli</option> <option value="Erode">Erode</option> <option value="Vellore">Vellore</option> <option value="Thoothukudi">Thoothukudi</option> <option value="Dindigul">Dindigul</option> </select>
        </div>
       </div>
      </div><!-- Parcel Details -->
      <div style="margin-top: 40px;">
       <h3 style="color: #212121; margin-bottom: 20px; font-weight: 500;">Parcel Details</h3>
       <div class="form-row">
        <div class="form-group"><label for="parcelWeight" class="form-label">Weight (kg)</label> <input type="number" id="parcelWeight" name="parcelWeight" class="form-input" step="0.1" required onchange="calculatePrice()">
        </div>
        <div class="form-group"><label for="parcelType" class="form-label">Parcel Type</label> <select id="parcelType" name="parcelType" class="form-select" required> <option value="">Select Type</option> <option value="Documents">Documents</option> <option value="Electronics">Electronics</option> <option value="Clothing">Clothing</option> <option value="Food Items">Food Items</option> <option value="Others">Others</option> </select>
        </div>
       </div>
       <div class="form-group"><label for="deliveryType" class="form-label">Delivery Type</label> <select id="deliveryType" name="deliveryType" class="form-select" required onchange="calculatePrice()"> <option value="">Select Delivery Type</option> <option value="standard">Standard Delivery (3-5 days) - ‚Çπ50 base</option> <option value="express">Express Delivery (1-2 days) - ‚Çπ100 base</option> <option value="same-day">Same Day Delivery - ‚Çπ200 base</option> </select>
       </div>
       <div class="form-group"><label style="display: flex; align-items: center; gap: 8px; cursor: pointer;"> <input type="checkbox" id="fragileItem" name="fragileItem" onchange="calculatePrice()" style="margin: 0;"> <span class="form-label" style="margin: 0;">Fragile Item (+‚Çπ50)</span> </label>
       </div>
       <div class="form-group"><label for="messageToRecipient" class="form-label">üí¨ Message to Recipient (Optional)</label> <textarea id="messageToRecipient" name="messageToRecipient" class="form-textarea" placeholder="Send a personal message with your parcel (e.g., Happy Birthday! Hope you enjoy this gift.)" maxlength="200" style="min-height: 60px;" oninput="updateMessageCounter()"></textarea>
        <div style="font-size: 12px; color: #696969; margin-top: 4px;"><span id="messageCounter">0</span>/200 characters
        </div>
       </div>
      </div><!-- Price Summary -->
      <div class="payment-summary" style="margin-top: 32px;">
       <h4 style="margin: 0 0 16px 0; color: #212121;">Price Summary</h4>
       <div class="payment-item"><span>Base Delivery Charge:</span> <span id="baseCharge">‚Çπ0</span>
       </div>
       <div class="payment-item"><span>Weight Charge:</span> <span id="weightCharge">‚Çπ0</span>
       </div>
       <div class="payment-total"><span>Total Amount:</span> <span id="estimatedCost">‚Çπ0</span>
       </div>
      </div>
      <div style="display: flex; gap: 16px; margin-top: 32px;"><button type="submit" class="btn btn-primary" style="flex: 1;">Book Parcel</button> <button type="button" class="btn btn-secondary" onclick="showPage('dashboard')">Cancel</button>
      </div>
     </form>
    </div>
   </div><!-- Tracking Page -->
   <div id="tracking" class="page">
    <div class="form-container">
     <h2 class="form-title">üîç Track Your Parcel</h2>
     <form id="trackingForm" onsubmit="handleTracking(event)">
      <div class="form-group"><label for="trackingNumber" class="form-label">Tracking Number</label> <input type="text" id="trackingNumber" name="trackingNumber" class="form-input" placeholder="Enter your tracking number (e.g., DP123456)" required>
      </div><button type="submit" class="btn btn-primary btn-full">Track Parcel</button>
     </form>
     <div id="trackingResult" class="tracking-result" style="display: none;">
      <div class="tracking-header">
       <div class="tracking-id" id="trackingId"></div>
       <div class="status-badge" id="trackingStatus"></div>
      </div>
      <div id="trackingDetails"></div>
      <div id="trackingTimeline"></div>
     </div>
    </div>
   </div><!-- Payment Page -->
   <div id="payment" class="page">
    <div class="form-container">
     <h2 class="form-title">üí≥ Pay Your Bills</h2>
     <div class="payment-summary">
      <h4 style="margin: 0 0 16px 0; color: #212121;">Outstanding Bills</h4>
      <div class="payment-item"><span>Parcel #DP001234 (Chennai ‚Üí Coimbatore)</span> <span>‚Çπ150</span>
      </div>
      <div class="payment-item"><span>Parcel #DP001235 (Madurai ‚Üí Salem)</span> <span>‚Çπ200</span>
      </div>
      <div class="payment-total"><span>Total Amount:</span> <span>‚Çπ350</span>
      </div>
     </div>
     <div class="form-group"><label for="paymentMethod" class="form-label">Select Payment Method</label> <select id="paymentMethod" name="paymentMethod" class="form-select" onchange="showPaymentMethod()" required> <option value="">Choose Payment Method</option> <option value="qr">QR Code Payment (UPI)</option> <option value="card">Credit/Debit Card</option> <option value="upi">UPI Payment</option> <option value="netbanking">Net Banking</option> </select>
     </div><!-- QR Payment -->
     <div id="qrPayment" class="payment-method">
      <div style="text-align: center;">
       <h4>Scan QR Code to Pay ‚Çπ350</h4><!-- QR Code Display -->
       <div class="qr-code" id="staticQRCode">
        <svg width="180" height="180" viewbox="0 0 180 180" style="border: 2px solid #2874f0; border-radius: 8px; background: white;"><!-- QR Code Pattern --> <rect x="10" y="10" width="30" height="30" fill="#000" /> <rect x="50" y="10" width="10" height="10" fill="#000" /> <rect x="70" y="10" width="10" height="10" fill="#000" /> <rect x="90" y="10" width="10" height="10" fill="#000" /> <rect x="110" y="10" width="10" height="10" fill="#000" /> <rect x="140" y="10" width="30" height="30" fill="#000" /> <rect x="10" y="50" width="10" height="10" fill="#000" /> <rect x="30" y="50" width="10" height="10" fill="#000" /> <rect x="50" y="50" width="20" height="10" fill="#000" /> <rect x="80" y="50" width="10" height="10" fill="#000" /> <rect x="100" y="50" width="20" height="10" fill="#000" /> <rect x="140" y="50" width="10" height="10" fill="#000" /> <rect x="160" y="50" width="10" height="10" fill="#000" /> <rect x="10" y="70" width="10" height="10" fill="#000" /> <rect x="30" y="70" width="10" height="10" fill="#000" /> <rect x="60" y="70" width="10" height="10" fill="#000" /> <rect x="80" y="70" width="30" height="10" fill="#000" /> <rect x="120" y="70" width="10" height="10" fill="#000" /> <rect x="140" y="70" width="10" height="10" fill="#000" /> <rect x="160" y="70" width="10" height="10" fill="#000" /> <rect x="10" y="90" width="10" height="10" fill="#000" /> <rect x="30" y="90" width="10" height="10" fill="#000" /> <rect x="50" y="90" width="10" height="10" fill="#000" /> <rect x="70" y="90" width="20" height="10" fill="#000" /> <rect x="100" y="90" width="10" height="10" fill="#000" /> <rect x="120" y="90" width="20" height="10" fill="#000" /> <rect x="150" y="90" width="20" height="10" fill="#000" /> <rect x="10" y="110" width="10" height="10" fill="#000" /> <rect x="30" y="110" width="10" height="10" fill="#000" /> <rect x="60" y="110" width="20" height="10" fill="#000" /> <rect x="90" y="110" width="10" height="10" fill="#000" /> <rect x="110" y="110" width="20" height="10" fill="#000" /> <rect x="140" y="110" width="10" height="10" fill="#000" /> <rect x="160" y="110" width="10" height="10" fill="#000" /> <rect x="10" y="140" width="30" height="30" fill="#000" /> <rect x="50" y="140" width="10" height="10" fill="#000" /> <rect x="70" y="140" width="20" height="10" fill="#000" /> <rect x="100" y="140" width="10" height="10" fill="#000" /> <rect x="120" y="140" width="10" height="10" fill="#000" /> <rect x="140" y="140" width="30" height="30" fill="#000" /> <!-- Corner squares --> <rect x="15" y="15" width="20" height="20" fill="#fff" /> <rect x="20" y="20" width="10" height="10" fill="#000" /> <rect x="145" y="15" width="20" height="20" fill="#fff" /> <rect x="150" y="20" width="10" height="10" fill="#000" /> <rect x="15" y="145" width="20" height="20" fill="#fff" /> <rect x="20" y="150" width="10" height="10" fill="#000" /> <!-- Center pattern --> <rect x="80" y="80" width="20" height="20" fill="#000" /> <rect x="85" y="85" width="10" height="10" fill="#fff" /> <rect x="88" y="88" width="4" height="4" fill="#000" />
        </svg>
        <div style="margin-top: 8px; font-size: 14px; color: #2874f0;">
         DIGI POST Payment - ‚Çπ350
        </div>
       </div><!-- QR Scanner Section -->
       <div style="margin: 20px 0;"><button class="btn btn-secondary" onclick="toggleQRScanner()" id="scannerToggleBtn"> üì∑ Scan QR Code from Bill </button>
       </div><!-- Camera Scanner -->
       <div id="qrScannerContainer" style="display: none; margin: 20px 0;">
        <div style="background: #f8f9fa; border: 2px dashed #2874f0; border-radius: 8px; padding: 20px; position: relative;">
         <video id="qrVideo" style="width: 100%; max-width: 300px; height: 200px; border-radius: 8px; background: #000;"></video>
         <canvas id="qrCanvas" style="display: none;"></canvas><!-- Scanner Overlay -->
         <div id="scannerOverlay" style="
                                    position: absolute;
                                    top: 50%;
                                    left: 50%;
                                    transform: translate(-50%, -50%);
                                    width: 150px;
                                    height: 150px;
                                    border: 2px solid #2874f0;
                                    border-radius: 8px;
                                    pointer-events: none;
                                ">
          <div style="
                                        position: absolute;
                                        top: -2px;
                                        left: -2px;
                                        width: 20px;
                                        height: 20px;
                                        border-top: 4px solid #ff6161;
                                        border-left: 4px solid #ff6161;
                                    "></div>
          <div style="
                                        position: absolute;
                                        top: -2px;
                                        right: -2px;
                                        width: 20px;
                                        height: 20px;
                                        border-top: 4px solid #ff6161;
                                        border-right: 4px solid #ff6161;
                                    "></div>
          <div style="
                                        position: absolute;
                                        bottom: -2px;
                                        left: -2px;
                                        width: 20px;
                                        height: 20px;
                                        border-bottom: 4px solid #ff6161;
                                        border-left: 4px solid #ff6161;
                                    "></div>
          <div style="
                                        position: absolute;
                                        bottom: -2px;
                                        right: -2px;
                                        width: 20px;
                                        height: 20px;
                                        border-bottom: 4px solid #ff6161;
                                        border-right: 4px solid #ff6161;
                                    "></div>
         </div><!-- Scanner Status -->
         <div id="scannerStatus" style="
                                    margin-top: 12px;
                                    padding: 8px;
                                    background: rgba(40, 116, 240, 0.1);
                                    border-radius: 4px;
                                    color: #2874f0;
                                    font-size: 14px;
                                ">
          üì∑ Position QR code within the frame
         </div><!-- Scanner Controls -->
         <div style="margin-top: 16px; display: flex; gap: 8px; justify-content: center;"><button class="btn btn-secondary" onclick="stopQRScanner()" style="font-size: 12px; padding: 8px 16px;"> Stop Scanner </button> <button class="btn btn-primary" onclick="switchCamera()" id="switchCameraBtn" style="font-size: 12px; padding: 8px 16px;"> üì∑ Switch Camera </button>
         </div>
        </div>
       </div><!-- Scanned QR Result -->
       <div id="scannedQRResult" style="display: none; margin: 20px 0; padding: 16px; background: #e8f5e8; border-radius: 8px; border: 1px solid #4caf50;">
        <div style="color: #2e7d32; font-weight: 500; margin-bottom: 8px;">
         ‚úÖ QR Code Scanned Successfully!
        </div>
        <div id="scannedQRData" style="font-size: 14px; color: #1b5e20; word-break: break-all;"></div><button class="btn btn-success" onclick="processScannedPayment()" style="margin-top: 12px; width: 100%;"> Process Payment </button>
       </div>
       <p style="color: #696969; margin: 16px 0;">Use Google Pay, PhonePe, Paytm, or any UPI app</p><button class="btn btn-success btn-full" onclick="processPayment()">I have paid ‚Çπ350</button>
      </div>
     </div><!-- Card Payment -->
     <div id="cardPayment" class="payment-method">
      <div class="form-group"><label for="cardNumber" class="form-label">Card Number</label> <input type="text" id="cardNumber" class="form-input" placeholder="1234 5678 9012 3456" maxlength="19">
      </div>
      <div class="form-row">
       <div class="form-group"><label for="expiryDate" class="form-label">Expiry Date</label> <input type="text" id="expiryDate" class="form-input" placeholder="MM/YY" maxlength="5">
       </div>
       <div class="form-group"><label for="cvv" class="form-label">CVV</label> <input type="text" id="cvv" class="form-input" placeholder="123" maxlength="3">
       </div>
      </div><button class="btn btn-success btn-full" onclick="processPayment()">Pay ‚Çπ350</button>
     </div><!-- UPI Payment -->
     <div id="upiPayment" class="payment-method">
      <div class="form-group"><label for="upiId" class="form-label">UPI ID</label> <input type="text" id="upiId" class="form-input" placeholder="yourname@paytm">
      </div><button class="btn btn-success btn-full" onclick="processPayment()">Pay ‚Çπ350</button>
     </div><!-- Net Banking -->
     <div id="netbankingPayment" class="payment-method">
      <div class="form-group"><label for="bankSelect" class="form-label">Select Your Bank</label> <select id="bankSelect" class="form-select"> <option value="">Choose your bank</option> <option value="sbi">State Bank of India</option> <option value="hdfc">HDFC Bank</option> <option value="icici">ICICI Bank</option> <option value="axis">Axis Bank</option> <option value="pnb">Punjab National Bank</option> <option value="canara">Canara Bank</option> <option value="bob">Bank of Baroda</option> </select>
      </div><button class="btn btn-success btn-full" onclick="processPayment()">Proceed to Bank Website</button>
     </div>
    </div>
   </div><!-- Delivery Status Page -->
   <div id="delivery" class="page">
    <div class="form-container" style="max-width: 800px;">
     <h2 class="form-title">üöö Delivery Status</h2>
     <div style="display: grid; gap: 24px;"><!-- Active Delivery 1 -->
      <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 24px; background: white;">
       <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <div>
         <div style="font-size: 18px; font-weight: 500; color: #212121;">
          Parcel #DP001234
         </div>
         <div style="color: #696969; font-size: 14px;">
          Chennai ‚Üí Coimbatore
         </div>
        </div>
        <div class="status-badge status-transit">
         In Transit
        </div>
       </div>
       <div class="timeline">
        <div class="timeline-item completed">
         <div class="timeline-title">
          Order Placed
         </div>
         <div class="timeline-time">
          Dec 15, 2024 - 10:30 AM
         </div>
        </div>
        <div class="timeline-item completed">
         <div class="timeline-title">
          Picked Up
         </div>
         <div class="timeline-time">
          Dec 15, 2024 - 2:15 PM
         </div>
        </div>
        <div class="timeline-item active">
         <div class="timeline-title">
          In Transit
         </div>
         <div class="timeline-time">
          Dec 15, 2024 - 6:45 PM
         </div>
        </div>
        <div class="timeline-item">
         <div class="timeline-title">
          Out for Delivery
         </div>
         <div class="timeline-time">
          Expected: Dec 16, 2024
         </div>
        </div>
        <div class="timeline-item">
         <div class="timeline-title">
          Delivered
         </div>
         <div class="timeline-time">
          Expected: Dec 16, 2024
         </div>
        </div>
       </div>
      </div><!-- Active Delivery 2 -->
      <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 24px; background: white;">
       <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <div>
         <div style="font-size: 18px; font-weight: 500; color: #212121;">
          Parcel #DP001235
         </div>
         <div style="color: #696969; font-size: 14px;">
          Madurai ‚Üí Salem
         </div>
        </div>
        <div class="status-badge status-processing">
         Processing
        </div>
       </div>
       <div class="timeline">
        <div class="timeline-item completed">
         <div class="timeline-title">
          Order Placed
         </div>
         <div class="timeline-time">
          Dec 15, 2024 - 3:45 PM
         </div>
        </div>
        <div class="timeline-item active">
         <div class="timeline-title">
          Processing
         </div>
         <div class="timeline-time">
          In progress
         </div>
        </div>
        <div class="timeline-item">
         <div class="timeline-title">
          Pickup Scheduled
         </div>
         <div class="timeline-time">
          Expected: Dec 16, 2024
         </div>
        </div>
        <div class="timeline-item">
         <div class="timeline-title">
          In Transit
         </div>
         <div class="timeline-time">
          Expected: Dec 16, 2024
         </div>
        </div>
        <div class="timeline-item">
         <div class="timeline-title">
          Delivered
         </div>
         <div class="timeline-time">
          Expected: Dec 18, 2024
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Customer Query Page -->
   <div id="customerQuery" class="page">
    <div class="form-container">
     <h2 class="form-title">üí¨ Report an Issue</h2>
     <p style="text-align: center; color: #696969; margin-bottom: 32px;">Having trouble with booking, delivery, or payment? Let us know and we'll help you right away!</p>
     <form id="customerQueryForm" onsubmit="handleCustomerQuery(event)">
      <div class="form-group"><label for="querySubject" class="form-label">Subject</label> <select id="querySubject" name="subject" class="form-select" required> <option value="">Select Issue Type</option> <option value="Booking Problem">Booking Problem</option> <option value="Payment Issue">Payment Issue</option> <option value="Tracking Not Working">Tracking Not Working</option> <option value="Delivery Delayed">Delivery Delayed</option> <option value="Parcel Damaged">Parcel Damaged</option> <option value="Wrong Address">Wrong Address</option> <option value="Refund Request">Refund Request</option> <option value="Other Issue">Other Issue</option> </select>
      </div>
      <div class="form-group"><label for="queryParcelId" class="form-label">Parcel ID (Optional)</label> <input type="text" id="queryParcelId" name="parcelId" class="form-input" placeholder="e.g., DP123456">
      </div>
      <div class="form-group"><label for="queryMessage" class="form-label">Describe Your Issue</label> <textarea id="queryMessage" name="message" class="form-textarea" required placeholder="Please provide details about your issue..." style="min-height: 120px;"></textarea>
      </div>
      <div class="form-group"><label for="queryContactPreference" class="form-label">Preferred Contact Method</label> <select id="queryContactPreference" name="contactPreference" class="form-select" required> <option value="email">Email</option> <option value="phone">Phone Call</option> <option value="sms">SMS</option> </select>
      </div><button type="submit" class="btn btn-primary btn-full">Submit Query</button>
     </form>
     <div style="text-align: center; margin-top: 24px;"><a href="#" onclick="showPage('myQueries')" style="color: #2874f0; text-decoration: none; font-size: 14px;"> View My Submitted Queries ‚Üí </a>
     </div>
    </div>
   </div><!-- My Queries Page -->
   <div id="myQueries" class="page">
    <div class="form-container" style="max-width: 900px;">
     <h2 class="form-title">üìã My Queries</h2>
     <div style="text-align: center; margin-bottom: 32px;"><button class="btn btn-primary" onclick="showPage('customerQuery')">+ Submit New Query</button>
     </div>
     <div id="userQueriesList"></div>
    </div>
   </div><!-- Price Calculator Page -->
   <div id="priceCalculator" class="page">
    <div class="form-container" style="max-width: 700px;">
     <h2 class="form-title">üí∞ Price Calculator</h2>
     <p style="text-align: center; color: #696969; margin-bottom: 32px;">Calculate shipping costs before booking your parcel</p>
     <form id="calculatorForm">
      <div class="form-row">
       <div class="form-group"><label for="calcFromCity" class="form-label">From City</label> <select id="calcFromCity" class="form-select" required onchange="calculateShippingPrice()"> <option value="">Select City</option> <option value="Chennai">Chennai</option> <option value="Coimbatore">Coimbatore</option> <option value="Madurai">Madurai</option> <option value="Tiruchirappalli">Tiruchirappalli</option> <option value="Salem">Salem</option> <option value="Tirunelveli">Tirunelveli</option> <option value="Erode">Erode</option> <option value="Vellore">Vellore</option> </select>
       </div>
       <div class="form-group"><label for="calcToCity" class="form-label">To City</label> <select id="calcToCity" class="form-select" required onchange="calculateShippingPrice()"> <option value="">Select City</option> <option value="Chennai">Chennai</option> <option value="Coimbatore">Coimbatore</option> <option value="Madurai">Madurai</option> <option value="Tiruchirappalli">Tiruchirappalli</option> <option value="Salem">Salem</option> <option value="Tirunelveli">Tirunelveli</option> <option value="Erode">Erode</option> <option value="Vellore">Vellore</option> </select>
       </div>
      </div>
      <div class="form-group"><label for="calcWeight" class="form-label">Package Weight (kg)</label> <input type="number" id="calcWeight" class="form-input" min="0.1" step="0.1" placeholder="Enter weight" required onchange="calculateShippingPrice()">
      </div>
      <div class="form-group"><label for="calcDeliveryType" class="form-label">Delivery Type</label> <select id="calcDeliveryType" class="form-select" required onchange="calculateShippingPrice()"> <option value="">Select Type</option> <option value="standard">Standard (3-5 days)</option> <option value="express">Express (1-2 days)</option> <option value="same-day">Same Day</option> </select>
      </div>
      <div class="form-group"><label style="display: flex; align-items: center; gap: 8px; cursor: pointer;"> <input type="checkbox" id="calcFragile" onchange="calculateShippingPrice()"> <span class="form-label" style="margin: 0;">Fragile Item (+‚Çπ50)</span> </label>
      </div>
      <div id="calculatorResult" style="display: none; background: #f8f9fa; padding: 24px; border-radius: 8px; margin-top: 24px;">
       <h4 style="margin: 0 0 16px 0; color: #212121;">Estimated Cost Breakdown</h4>
       <div class="payment-item"><span>Distance:</span> <span id="calcDistance">-</span>
       </div>
       <div class="payment-item"><span>Base Delivery Charge:</span> <span id="calcBaseCharge">‚Çπ0</span>
       </div>
       <div class="payment-item"><span>Weight Charge:</span> <span id="calcWeightCharge">‚Çπ0</span>
       </div>
       <div class="payment-item"><span>Distance Charge:</span> <span id="calcDistanceCharge">‚Çπ0</span>
       </div>
       <div class="payment-item"><span>Additional Charges:</span> <span id="calcAdditionalCharge">‚Çπ0</span>
       </div>
       <div class="payment-total"><span>Total Estimated Cost:</span> <span id="calcTotal">‚Çπ0</span>
       </div><button type="button" class="btn btn-primary btn-full" onclick="proceedToBookingFromCalculator()" style="margin-top: 16px;"> Proceed to Book Parcel </button>
      </div>
     </form>
    </div>
   </div><!-- Analytics Page -->
   <div id="analytics" class="page">
    <div class="form-container" style="max-width: 1000px;">
     <h2 class="form-title">üìä My Shipping Analytics</h2>
     <div class="stats-grid" style="margin-bottom: 40px;">
      <div class="stat-card">
       <div class="stat-number" id="analyticsTotal">
        0
       </div>
       <div class="stat-label">
        Total Shipments
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-number" id="analyticsSpent">
        ‚Çπ0
       </div>
       <div class="stat-label">
        Total Spent
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-number" id="analyticsAvgCost">
        ‚Çπ0
       </div>
       <div class="stat-label">
        Avg. Cost/Parcel
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-number" id="analyticsOnTime">
        0%
       </div>
       <div class="stat-label">
        On-Time Delivery
       </div>
      </div>
     </div>
     <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 40px;">
      <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 24px;">
       <h3 style="margin: 0 0 16px 0; font-size: 18px;">Most Used Routes</h3>
       <div id="topRoutes"></div>
      </div>
      <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 24px;">
       <h3 style="margin: 0 0 16px 0; font-size: 18px;">Parcel Types</h3>
       <div id="parcelTypes"></div>
      </div>
     </div>
     <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 24px;">
      <h3 style="margin: 0 0 16px 0; font-size: 18px;">Monthly Shipping Trend</h3>
      <div id="monthlyChart" style="height: 200px; display: flex; align-items: flex-end; gap: 8px; justify-content: space-between;"></div>
     </div>
    </div>
   </div><!-- Bulk Booking Page -->
   <div id="bulkBooking" class="page">
    <div class="form-container" style="max-width: 900px;">
     <h2 class="form-title">üì¶ Bulk Parcel Booking</h2>
     <p style="text-align: center; color: #696969; margin-bottom: 32px;">Book multiple parcels at once - Perfect for businesses and bulk shippers</p>
     <div style="background: #e3f2fd; padding: 16px; border-radius: 8px; margin-bottom: 24px; border-left: 4px solid #2196f3;"><strong>üí° Bulk Booking Benefits:</strong>
      <ul style="margin: 8px 0 0 20px; color: #696969;">
       <li>10% discount on orders of 5+ parcels</li>
       <li>20% discount on orders of 10+ parcels</li>
       <li>Priority pickup scheduling</li>
       <li>Dedicated customer support</li>
      </ul>
     </div>
     <div id="bulkParcelsList"></div><button class="btn btn-primary" onclick="addBulkParcelRow()" style="margin-bottom: 24px;"> + Add Another Parcel </button>
     <div id="bulkSummary" style="display: none; background: #f8f9fa; padding: 24px; border-radius: 8px; margin-bottom: 24px;">
      <h4 style="margin: 0 0 16px 0;">Bulk Order Summary</h4>
      <div class="payment-item"><span>Total Parcels:</span> <span id="bulkTotalParcels">0</span>
      </div>
      <div class="payment-item"><span>Subtotal:</span> <span id="bulkSubtotal">‚Çπ0</span>
      </div>
      <div class="payment-item" style="color: #4caf50;"><span>Bulk Discount:</span> <span id="bulkDiscount">- ‚Çπ0</span>
      </div>
      <div class="payment-total"><span>Total Amount:</span> <span id="bulkTotal">‚Çπ0</span>
      </div>
     </div><button class="btn btn-success btn-full" onclick="submitBulkBooking()"> Submit Bulk Order </button>
    </div>
   </div><!-- Live Support Page -->
   <div id="liveSupport" class="page">
    <div class="form-container" style="max-width: 800px;">
     <h2 class="form-title">üí¨ Live Customer Support</h2>
     <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px;">
      <div>
       <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; height: 500px; display: flex; flex-direction: column;">
        <div style="padding: 16px; border-bottom: 1px solid #e0e0e0; background: #2874f0; color: white; border-radius: 8px 8px 0 0;"><strong>Chat with Support Team</strong>
         <div style="font-size: 12px; opacity: 0.9;">
          Average response time: 2 minutes
         </div>
        </div>
        <div id="liveChatMessages" style="flex: 1; padding: 16px; overflow-y: auto; background: #f8f9fa;"></div>
        <div style="padding: 16px; border-top: 1px solid #e0e0e0; background: white;">
         <div style="display: flex; gap: 8px;"><input type="text" id="liveChatInput" class="form-input" placeholder="Type your message..." onkeypress="handleLiveChatKeypress(event)" style="margin: 0;"> <button class="btn btn-primary" onclick="sendLiveChatMessage()">Send</button>
         </div>
        </div>
       </div>
      </div>
      <div>
       <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 16px;">
        <h4 style="margin: 0 0 12px 0; font-size: 16px;">Quick Actions</h4><button class="btn btn-secondary btn-full" onclick="sendQuickMessage('Track my parcel')" style="margin-bottom: 8px; font-size: 14px;"> üìç Track Parcel </button> <button class="btn btn-secondary btn-full" onclick="sendQuickMessage('Payment issue')" style="margin-bottom: 8px; font-size: 14px;"> üí≥ Payment Help </button> <button class="btn btn-secondary btn-full" onclick="sendQuickMessage('Change delivery address')" style="margin-bottom: 8px; font-size: 14px;"> üìÆ Address Change </button> <button class="btn btn-secondary btn-full" onclick="sendQuickMessage('Booking issue')" style="font-size: 14px;"> üì¶ Booking Help </button>
       </div>
       <div style="background: #e8f5e8; border: 1px solid #4caf50; border-radius: 8px; padding: 16px;">
        <div style="font-weight: 500; margin-bottom: 8px; color: #2e7d32;">
         üü¢ Support Available
        </div>
        <div style="font-size: 14px; color: #1b5e20;">
         Our team is online and ready to help you!
        </div>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Insurance Page -->
   <div id="insurance" class="page">
    <div class="form-container" style="max-width: 700px;">
     <h2 class="form-title">üõ°Ô∏è Parcel Insurance</h2>
     <p style="text-align: center; color: #696969; margin-bottom: 32px;">Protect your valuable shipments with comprehensive insurance coverage</p>
     <div style="display: grid; gap: 20px; margin-bottom: 32px;">
      <div style="border: 2px solid #e0e0e0; border-radius: 8px; padding: 24px; transition: all 0.3s;" onmouseover="this.style.borderColor='#2874f0'" onmouseout="this.style.borderColor='#e0e0e0'">
       <h3 style="margin: 0 0 12px 0; color: #2874f0;">Basic Coverage - ‚Çπ50</h3>
       <p style="color: #696969; margin-bottom: 16px;">Coverage up to ‚Çπ5,000</p>
       <ul style="color: #696969; margin: 0; padding-left: 20px;">
        <li>Loss or theft protection</li>
        <li>Damage during transit</li>
        <li>48-hour claim processing</li>
       </ul>
      </div>
      <div style="border: 2px solid #4caf50; border-radius: 8px; padding: 24px; background: #e8f5e8;">
       <div style="background: #4caf50; color: white; padding: 4px 12px; border-radius: 12px; display: inline-block; font-size: 12px; margin-bottom: 12px;">
        RECOMMENDED
       </div>
       <h3 style="margin: 0 0 12px 0; color: #2e7d32;">Standard Coverage - ‚Çπ150</h3>
       <p style="color: #696969; margin-bottom: 16px;">Coverage up to ‚Çπ25,000</p>
       <ul style="color: #696969; margin: 0; padding-left: 20px;">
        <li>All Basic Coverage benefits</li>
        <li>Weather damage protection</li>
        <li>Express claim processing (24 hours)</li>
        <li>Priority customer support</li>
       </ul>
      </div>
      <div style="border: 2px solid #ff9800; border-radius: 8px; padding: 24px; background: #fff3e0;">
       <h3 style="margin: 0 0 12px 0; color: #f57c00;">Premium Coverage - ‚Çπ300</h3>
       <p style="color: #696969; margin-bottom: 16px;">Coverage up to ‚Çπ1,00,000</p>
       <ul style="color: #696969; margin: 0; padding-left: 20px;">
        <li>All Standard Coverage benefits</li>
        <li>Comprehensive all-risk protection</li>
        <li>Instant claim processing (12 hours)</li>
        <li>Dedicated claims manager</li>
        <li>International transit coverage</li>
       </ul>
      </div>
     </div><button class="btn btn-primary btn-full" onclick="showPage('booking')"> Add Insurance to Booking </button>
    </div>
   </div><!-- Saved Addresses Page -->
   <div id="savedAddresses" class="page">
    <div class="form-container" style="max-width: 800px;">
     <h2 class="form-title">üìç Saved Addresses</h2>
     <p style="text-align: center; color: #696969; margin-bottom: 32px;">Save frequently used addresses for faster booking</p><button class="btn btn-primary" onclick="showAddAddressForm()" style="margin-bottom: 24px;"> + Add New Address </button>
     <div id="addAddressForm" style="display: none; background: #f8f9fa; padding: 24px; border-radius: 8px; margin-bottom: 24px;">
      <h4 style="margin: 0 0 16px 0;">Add New Address</h4>
      <form id="newAddressForm" onsubmit="saveNewAddress(event)">
       <div class="form-group"><label class="form-label">Address Label</label> <input type="text" id="addressLabel" class="form-input" placeholder="e.g., Home, Office, Warehouse" required>
       </div>
       <div class="form-group"><label class="form-label">Full Name</label> <input type="text" id="addressName" class="form-input" required>
       </div>
       <div class="form-row">
        <div class="form-group"><label class="form-label">Phone</label> <input type="tel" id="addressPhone" class="form-input" required>
        </div>
        <div class="form-group"><label class="form-label">City</label> <select id="addressCity" class="form-select" required> <option value="">Select City</option> <option value="Chennai">Chennai</option> <option value="Coimbatore">Coimbatore</option> <option value="Madurai">Madurai</option> <option value="Salem">Salem</option> </select>
        </div>
       </div>
       <div class="form-group"><label class="form-label">Full Address</label> <textarea id="addressFull" class="form-textarea" required></textarea>
       </div>
       <div style="display: flex; gap: 12px;"><button type="submit" class="btn btn-success">Save Address</button> <button type="button" class="btn btn-secondary" onclick="hideAddAddressForm()">Cancel</button>
       </div>
      </form>
     </div>
     <div id="savedAddressesList"></div>
    </div>
   </div><!-- Profile Page -->
   <div id="profile" class="page">
    <div class="form-container" style="max-width: 900px;">
     <h2 class="form-title">My Profile</h2>
     <div style="display: grid; grid-template-columns: 300px 1fr; gap: 32px;"><!-- Profile Picture Section -->
      <div>
       <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 24px; text-align: center;">
        <div style="position: relative; width: 150px; height: 150px; margin: 0 auto 16px;"><img id="profilePicture" src="" alt="Profile" style="
                                    width: 150px;
                                    height: 150px;
                                    border-radius: 50%;
                                    object-fit: cover;
                                    border: 3px solid #2874f0;
                                    background: #f0f0f0;
                                    display: none;
                                ">
         <div id="profilePlaceholder" style="
                                    width: 150px;
                                    height: 150px;
                                    border-radius: 50%;
                                    background: linear-gradient(135deg, #2874f0 0%, #1e5bb8 100%);
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-size: 48px;
                                    color: white;
                                    font-weight: 500;
                                "></div>
        </div><input type="file" id="profilePictureInput" accept="image/*" style="display: none;" onchange="handleProfilePictureUpload(event)"> <button class="btn btn-primary btn-full" onclick="document.getElementById('profilePictureInput').click()"> üì∑ Upload Photo </button> <button class="btn btn-secondary btn-full" onclick="removeProfilePicture()" style="margin-top: 8px;"> Remove Photo </button>
       </div>
       <div style="background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px; margin-top: 16px;">
        <div style="font-size: 14px; color: #696969; margin-bottom: 8px;"><strong>Account Status</strong>
        </div>
        <div style="display: flex; align-items: center; gap: 8px; color: #4caf50;"><span style="font-size: 20px;">‚úì</span> <span style="font-weight: 500;">Active</span>
        </div>
        <div style="font-size: 12px; color: #696969; margin-top: 8px;">
         Member since <span id="memberSince"></span>
        </div>
       </div>
      </div><!-- Profile Details Section -->
      <div>
       <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 24px; margin-bottom: 24px;">
        <h3 style="margin: 0 0 20px 0; color: #212121;">Personal Information</h3>
        <form id="profileForm" onsubmit="updateProfile(event)">
         <div class="form-group"><label for="profileName" class="form-label">Full Name</label> <input type="text" id="profileName" class="form-input" required>
         </div>
         <div class="form-row">
          <div class="form-group"><label for="profileEmail" class="form-label">Email Address</label> <input type="email" id="profileEmail" class="form-input" required>
          </div>
          <div class="form-group"><label for="profilePhone" class="form-label">Phone Number</label> <input type="tel" id="profilePhone" class="form-input" required>
          </div>
         </div>
         <div class="form-row">
          <div class="form-group"><label for="profileCity" class="form-label">City</label> <select id="profileCity" class="form-select" required> <option value="">Select City</option> <option value="Chennai">Chennai</option> <option value="Coimbatore">Coimbatore</option> <option value="Madurai">Madurai</option> <option value="Tiruchirappalli">Tiruchirappalli</option> <option value="Salem">Salem</option> <option value="Tirunelveli">Tirunelveli</option> <option value="Erode">Erode</option> <option value="Vellore">Vellore</option> </select>
          </div>
          <div class="form-group"><label for="profilePincode" class="form-label">Pincode</label> <input type="text" id="profilePincode" class="form-input" maxlength="6">
          </div>
         </div>
         <div class="form-group"><label for="profileAddress" class="form-label">Full Address</label> <textarea id="profileAddress" class="form-textarea"></textarea>
         </div><button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
       </div>
       <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 24px;">
        <h3 style="margin: 0 0 20px 0; color: #212121;">Change Password</h3>
        <form id="passwordForm" onsubmit="changePassword(event)">
         <div class="form-group"><label for="currentPassword" class="form-label">Current Password</label> <input type="password" id="currentPassword" class="form-input" required>
         </div>
         <div class="form-group"><label for="newPassword" class="form-label">New Password</label> <input type="password" id="newPassword" class="form-input" required>
         </div>
         <div class="form-group"><label for="confirmPassword" class="form-label">Confirm New Password</label> <input type="password" id="confirmPassword" class="form-input" required>
         </div><button type="submit" class="btn btn-success">Update Password</button>
        </form>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Payment History Page -->
   <div id="paymentHistory" class="page">
    <div class="form-container" style="max-width: 1000px;">
     <h2 class="form-title">üí≥ Payment History &amp; Receipts</h2>
     <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 24px; margin-bottom: 24px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
       <div>
        <h3 style="margin: 0; color: #212121;">Transaction Summary</h3>
        <p style="margin: 4px 0 0 0; color: #696969;">All your payment records in one place</p>
       </div><button class="btn btn-primary" onclick="downloadAllPaymentHistory()"> üì• Download All History </button>
      </div>
      <div class="stats-grid" style="margin-bottom: 0;">
       <div class="stat-card">
        <div class="stat-number" id="totalTransactions">
         0
        </div>
        <div class="stat-label">
         Total Transactions
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-number" id="totalAmountPaid">
         ‚Çπ0
        </div>
        <div class="stat-label">
         Total Paid
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-number" id="pendingPayments">
         0
        </div>
        <div class="stat-label">
         Pending Payments
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-number" id="lastPaymentDate">
         -
        </div>
        <div class="stat-label">
         Last Payment
        </div>
       </div>
      </div>
     </div>
     <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 24px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
       <h3 style="margin: 0; color: #212121;">Payment Records</h3><select id="paymentFilter" class="form-select" onchange="filterPayments()" style="width: auto;"> <option value="all">All Payments</option> <option value="completed">Completed</option> <option value="pending">Pending</option> </select>
      </div>
      <div id="paymentHistoryList"></div>
     </div>
    </div>
   </div><!-- Admin Login Page -->
   <div id="adminLogin" class="page">
    <div class="form-container">
     <h2 class="form-title">ÔøΩÔøΩÔøΩÔøΩ Admin Login</h2>
     <form id="adminLoginForm" onsubmit="handleAdminLogin(event)">
      <div class="form-group"><label for="adminEmail" class="form-label">Admin Email</label> <input type="email" id="adminEmail" name="email" class="form-input" value="admin@digipost.com" required>
      </div>
      <div class="form-group"><label for="adminPassword" class="form-label">Admin Password</label> <input type="password" id="adminPassword" name="password" class="form-input" value="admin123" required>
      </div><button type="submit" class="btn btn-primary btn-full">Login as Admin</button>
     </form>
     <p style="text-align: center; margin-top: 24px; color: #696969; font-size: 12px;">Demo credentials: admin@digipost.com / admin123</p>
    </div>
   </div><!-- Admin Dashboard -->
   <div id="adminDashboard" class="page">
    <div class="dashboard-header">
     <div style="display: flex; justify-content: space-between; align-items: center;">
      <div>
       <h1 class="dashboard-title">Admin Control Panel</h1>
       <p class="dashboard-subtitle">Manage parcels, users, and customer queries</p>
      </div><button class="btn btn-secondary" onclick="adminLogout()">Logout</button>
     </div>
    </div>
    <div class="dashboard-content"><!-- Admin Stats -->
     <div class="stats-grid">
      <div class="stat-card">
       <div class="stat-number" id="adminTotalParcels">
        0
       </div>
       <div class="stat-label">
        Total Parcels
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-number" id="adminTotalUsers">
        0
       </div>
       <div class="stat-label">
        Total Users
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-number" id="adminPendingDeliveries">
        0
       </div>
       <div class="stat-label">
        Pending Deliveries
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-number" id="adminTotalQueries">
        0
       </div>
       <div class="stat-label">
        Customer Queries
       </div>
      </div>
     </div><!-- Admin Navigation Tabs -->
     <div style="display: flex; gap: 16px; margin: 32px 0; border-bottom: 2px solid #e0e0e0;"><button class="admin-tab active" onclick="showAdminTab('parcels')">üì¶ Parcels Management</button> <button class="admin-tab" onclick="showAdminTab('users')">üë• User Management</button> <button class="admin-tab" onclick="showAdminTab('queries')">üí¨ Customer Queries</button>
     </div><!-- Parcels Management Tab -->
     <div id="adminParcelsTab" class="admin-tab-content active">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
       <h3 style="margin: 0; color: #212121;">All Parcels</h3>
       <div style="display: flex; gap: 12px;"><select id="parcelStatusFilter" class="form-select" onchange="filterAdminParcels()" style="width: auto;"> <option value="">All Status</option> <option value="Processing">Processing</option> <option value="Picked Up">Picked Up</option> <option value="In Transit">In Transit</option> <option value="Out for Delivery">Out for Delivery</option> <option value="Delivered">Delivered</option> </select>
       </div>
      </div>
      <div id="adminParcelsList"></div>
     </div><!-- User Management Tab -->
     <div id="adminUsersTab" class="admin-tab-content">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
       <h3 style="margin: 0; color: #212121;">Registered Users</h3><input type="text" id="userSearchInput" class="form-input" placeholder="Search users..." onkeyup="searchUsers()" style="width: 300px;">
      </div>
      <div id="adminUsersList"></div>
     </div><!-- Customer Queries Tab -->
     <div id="adminQueriesTab" class="admin-tab-content">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
       <h3 style="margin: 0; color: #212121;">Customer Queries</h3><select id="queryStatusFilter" class="form-select" onchange="filterQueries()" style="width: auto;"> <option value="">All Queries</option> <option value="pending">Pending</option> <option value="resolved">Resolved</option> </select>
      </div>
      <div id="adminQueriesList"></div>
     </div>
    </div>
   </div>
  </main><!-- Chatbot --> <button class="chat-toggle" onclick="toggleChatbot()">üí¨</button>
  <div class="chatbot" id="chatbot">
   <div class="chatbot-header">
    <div class="chatbot-title">
     DIGI POST Support
    </div><button class="chatbot-close" onclick="toggleChatbot()">√ó</button>
   </div>
   <div class="chatbot-messages" id="chatMessages">
    <div class="message bot">
     <div class="message-content">
      Hello! I'm your DIGI POST assistant. How can I help you today?
     </div>
    </div>
   </div>
   <div class="chatbot-input"><input type="text" id="chatInput" class="chat-input" placeholder="Type your message..." onkeypress="handleChatKeypress(event)"> <button class="chat-send" onclick="sendMessage()">Send</button>
   </div>
  </div>
  <script>
        // Real-time QR Code Scanner System
        class QRCodeScanner {
            constructor() {
                this.video = null;
                this.canvas = null;
                this.context = null;
                this.stream = null;
                this.scanning = false;
                this.cameras = [];
                this.currentCameraIndex = 0;
                this.scanInterval = null;
            }

            async initializeScanner() {
                this.video = document.getElementById('qrVideo');
                this.canvas = document.getElementById('qrCanvas');
                this.context = this.canvas.getContext('2d');
                
                try {
                    // Get available cameras
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    this.cameras = devices.filter(device => device.kind === 'videoinput');
                    
                    if (this.cameras.length === 0) {
                        throw new Error('No cameras found');
                    }
                    
                    await this.startCamera();
                    this.startScanning();
                    
                    return true;
                } catch (error) {
                    console.error('Camera initialization failed:', error);
                    this.showScannerError('Camera access denied or not available. Please allow camera permissions.');
                    return false;
                }
            }

            async startCamera() {
                const constraints = {
                    video: {
                        deviceId: this.cameras[this.currentCameraIndex]?.deviceId,
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: this.cameras.length > 1 ? 'environment' : 'user'
                    }
                };

                try {
                    if (this.stream) {
                        this.stream.getTracks().forEach(track => track.stop());
                    }
                    
                    this.stream = await navigator.mediaDevices.getUserMedia(constraints);
                    this.video.srcObject = this.stream;
                    
                    return new Promise((resolve) => {
                        this.video.onloadedmetadata = () => {
                            this.video.play();
                            resolve();
                        };
                    });
                } catch (error) {
                    throw new Error('Failed to access camera: ' + error.message);
                }
            }

            startScanning() {
                this.scanning = true;
                this.scanInterval = setInterval(() => {
                    if (this.video.readyState === this.video.HAVE_ENOUGH_DATA) {
                        this.scanFrame();
                    }
                }, 250); // Scan every 250ms for better performance
            }

            scanFrame() {
                if (!this.scanning) return;

                const { videoWidth, videoHeight } = this.video;
                this.canvas.width = videoWidth;
                this.canvas.height = videoHeight;
                
                this.context.drawImage(this.video, 0, 0, videoWidth, videoHeight);
                const imageData = this.context.getImageData(0, 0, videoWidth, videoHeight);
                
                // Simple QR code detection simulation
                // In a real implementation, you would use a library like jsQR
                const qrData = this.detectQRCode(imageData);
                
                if (qrData) {
                    this.onQRCodeDetected(qrData);
                }
            }

            detectQRCode(imageData) {
                // Simulate QR code detection
                // This is a simplified version - in reality you'd use jsQR or similar library
                const data = imageData.data;
                let darkPixels = 0;
                let totalPixels = data.length / 4;
                
                // Count dark pixels (simple pattern detection)
                for (let i = 0; i < data.length; i += 4) {
                    const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;
                    if (brightness < 128) darkPixels++;
                }
                
                const darkRatio = darkPixels / totalPixels;
                
                // Simulate QR code detection based on dark pixel ratio and random chance
                if (darkRatio > 0.3 && darkRatio < 0.7 && Math.random() > 0.95) {
                    // Generate sample QR data for demonstration
                    const sampleQRData = this.generateSampleQRData();
                    return sampleQRData;
                }
                
                return null;
            }

            generateSampleQRData() {
                const qrTypes = [
                    'upi://pay?pa=merchant@paytm&pn=DIGI POST&am=350&cu=INR&tn=Bill Payment',
                    'upi://pay?pa=digipost@okaxis&pn=DIGI POST SERVICES&am=350&cu=INR&tn=Parcel Payment',
                    'https://pay.google.com/gp/p/ui/pay?pa=digipost@ybl&pn=DIGI POST&am=350&cu=INR',
                    'phonepe://pay?pa=digipost@ybl&pn=DIGI POST&am=350&cu=INR&tn=Bill Payment'
                ];
                
                return qrTypes[Math.floor(Math.random() * qrTypes.length)];
            }

            onQRCodeDetected(qrData) {
                this.scanning = false;
                clearInterval(this.scanInterval);
                
                // Update scanner status
                document.getElementById('scannerStatus').innerHTML = '‚úÖ QR Code Detected!';
                document.getElementById('scannerStatus').style.background = 'rgba(76, 175, 80, 0.1)';
                document.getElementById('scannerStatus').style.color = '#2e7d32';
                
                // Show scanned result
                document.getElementById('scannedQRData').textContent = qrData;
                document.getElementById('scannedQRResult').style.display = 'block';
                
                // Add success animation
                this.animateSuccess();
                
                showNotification('QR Code scanned successfully!', 'success');
            }

            animateSuccess() {
                const overlay = document.getElementById('scannerOverlay');
                overlay.style.borderColor = '#4caf50';
                overlay.style.animation = 'pulse 0.5s ease-in-out';
                
                setTimeout(() => {
                    overlay.style.animation = '';
                    overlay.style.borderColor = '#2874f0';
                }, 500);
            }

            async switchCamera() {
                if (this.cameras.length <= 1) {
                    showNotification('Only one camera available', 'info');
                    return;
                }
                
                this.currentCameraIndex = (this.currentCameraIndex + 1) % this.cameras.length;
                
                try {
                    await this.startCamera();
                    showNotification('Camera switched successfully', 'success');
                } catch (error) {
                    showNotification('Failed to switch camera', 'error');
                }
            }

            stopScanner() {
                this.scanning = false;
                
                if (this.scanInterval) {
                    clearInterval(this.scanInterval);
                    this.scanInterval = null;
                }
                
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                    this.stream = null;
                }
                
                if (this.video) {
                    this.video.srcObject = null;
                }
            }

            showScannerError(message) {
                document.getElementById('scannerStatus').innerHTML = `‚ùå ${message}`;
                document.getElementById('scannerStatus').style.background = 'rgba(244, 67, 54, 0.1)';
                document.getElementById('scannerStatus').style.color = '#d32f2f';
            }
        }

        // Initialize QR Scanner
        let qrScanner = new QRCodeScanner();

        // QR Scanner Functions
        async function toggleQRScanner() {
            const container = document.getElementById('qrScannerContainer');
            const toggleBtn = document.getElementById('scannerToggleBtn');
            
            if (container.style.display === 'none') {
                // Show scanner
                container.style.display = 'block';
                toggleBtn.textContent = 'ÔøΩÔøΩÔøΩÔøΩ Hide Scanner';
                toggleBtn.classList.remove('btn-secondary');
                toggleBtn.classList.add('btn-primary');
                
                // Reset previous results
                document.getElementById('scannedQRResult').style.display = 'none';
                document.getElementById('scannerStatus').innerHTML = 'üì∑ Initializing camera...';
                document.getElementById('scannerStatus').style.background = 'rgba(40, 116, 240, 0.1)';
                document.getElementById('scannerStatus').style.color = '#2874f0';
                
                // Initialize scanner
                const success = await qrScanner.initializeScanner();
                if (success) {
                    document.getElementById('scannerStatus').innerHTML = 'üì∑ Position QR code within the frame';
                }
            } else {
                // Hide scanner
                stopQRScanner();
            }
        }

        function stopQRScanner() {
            const container = document.getElementById('qrScannerContainer');
            const toggleBtn = document.getElementById('scannerToggleBtn');
            
            container.style.display = 'none';
            toggleBtn.textContent = 'üì∑ Scan QR Code from Bill';
            toggleBtn.classList.remove('btn-primary');
            toggleBtn.classList.add('btn-secondary');
            
            qrScanner.stopScanner();
            
            // Reset results
            document.getElementById('scannedQRResult').style.display = 'none';
        }

        function switchCamera() {
            qrScanner.switchCamera();
        }

        function processScannedPayment() {
            const qrData = document.getElementById('scannedQRData').textContent;
            
            // Parse QR data to extract payment information
            let paymentInfo = parseQRPaymentData(qrData);
            
            showNotification('Processing scanned payment...', 'info');
            
            // Simulate payment processing
            setTimeout(() => {
                showNotification(`Payment of ‚Çπ${paymentInfo.amount} processed successfully via ${paymentInfo.method}!`, 'success');
                stopQRScanner();
                showPage('dashboard');
            }, 2000);
        }

        function parseQRPaymentData(qrData) {
            // Extract payment information from QR data
            let amount = '350';
            let method = 'UPI';
            let merchant = 'DIGI POST';
            
            if (qrData.includes('am=')) {
                const amountMatch = qrData.match(/am=(\d+)/);
                if (amountMatch) amount = amountMatch[1];
            }
            
            if (qrData.includes('phonepe://')) method = 'PhonePe';
            else if (qrData.includes('pay.google.com')) method = 'Google Pay';
            else if (qrData.includes('paytm')) method = 'Paytm';
            
            if (qrData.includes('pn=')) {
                const merchantMatch = qrData.match(/pn=([^&]+)/);
                if (merchantMatch) merchant = decodeURIComponent(merchantMatch[1]);
            }
            
            return { amount, method, merchant };
        }

        // Enhanced Data Management System
        class DigiPostAPI {
            constructor() {
                this.users = JSON.parse(localStorage.getItem('digiPostUsers')) || [];
                this.parcels = JSON.parse(localStorage.getItem('digiPostParcels')) || [];
                this.notifications = JSON.parse(localStorage.getItem('digiPostNotifications')) || [];
                this.queries = JSON.parse(localStorage.getItem('digiPostQueries')) || [];
                this.analytics = JSON.parse(localStorage.getItem('digiPostAnalytics')) || this.initAnalytics();
                this.currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
                this.isAdmin = JSON.parse(localStorage.getItem('isAdmin')) || false;
                this.initializeRealTimeFeatures();
            }

            initAnalytics() {
                return {
                    totalBookings: 0,
                    totalRevenue: 0,
                    popularRoutes: {},
                    dailyStats: {},
                    userEngagement: {}
                };
            }

            initializeRealTimeFeatures() {
                // Simulate real-time parcel updates
                setInterval(() => this.updateParcelStatuses(), 30000);
                // Auto-save data every 5 minutes
                setInterval(() => this.saveAllData(), 300000);
                // Update analytics
                setInterval(() => this.updateAnalytics(), 60000);
            }

            updateParcelStatuses() {
                this.parcels.forEach(parcel => {
                    if (parcel.status === 'Processing' && Math.random() > 0.7) {
                        parcel.status = 'Picked Up';
                        this.addNotification(parcel.userId, `Parcel ${parcel.id} has been picked up!`);
                    } else if (parcel.status === 'Picked Up' && Math.random() > 0.8) {
                        parcel.status = 'In Transit';
                        this.addNotification(parcel.userId, `Parcel ${parcel.id} is now in transit!`);
                    } else if (parcel.status === 'In Transit' && Math.random() > 0.9) {
                        parcel.status = 'Out for Delivery';
                        this.addNotification(parcel.userId, `Parcel ${parcel.id} is out for delivery!`);
                    }
                });
                this.saveAllData();
            }

            addNotification(userId, message) {
                this.notifications.push({
                    id: Date.now(),
                    userId: userId,
                    message: message,
                    timestamp: new Date().toISOString(),
                    read: false
                });
            }

            updateAnalytics() {
                const today = new Date().toDateString();
                if (!this.analytics.dailyStats[today]) {
                    this.analytics.dailyStats[today] = { bookings: 0, revenue: 0 };
                }
                
                this.analytics.totalBookings = this.parcels.length;
                this.analytics.totalRevenue = this.parcels.reduce((sum, p) => sum + (p.cost || 150), 0);
                
                // Update popular routes
                this.parcels.forEach(parcel => {
                    const route = `${parcel.senderCity} ‚Üí ${parcel.receiverCity}`;
                    this.analytics.popularRoutes[route] = (this.analytics.popularRoutes[route] || 0) + 1;
                });
            }

            saveAllData() {
                localStorage.setItem('digiPostUsers', JSON.stringify(this.users));
                localStorage.setItem('digiPostParcels', JSON.stringify(this.parcels));
                localStorage.setItem('digiPostNotifications', JSON.stringify(this.notifications));
                localStorage.setItem('digiPostQueries', JSON.stringify(this.queries));
                localStorage.setItem('digiPostAnalytics', JSON.stringify(this.analytics));
                localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                localStorage.setItem('isAdmin', JSON.stringify(this.isAdmin));
            }

            addQuery(query) {
                this.queries.push({
                    id: Date.now(),
                    userId: query.userId,
                    userName: query.userName,
                    userEmail: query.userEmail,
                    subject: query.subject,
                    message: query.message,
                    status: 'pending',
                    timestamp: new Date().toISOString(),
                    response: null
                });
                this.saveAllData();
            }

            updateQueryStatus(queryId, status, response = null) {
                const query = this.queries.find(q => q.id === queryId);
                if (query) {
                    query.status = status;
                    query.response = response;
                    if (status === 'resolved') {
                        query.resolvedAt = new Date().toISOString();
                    }
                    this.saveAllData();
                }
            }

            deleteUser(userId) {
                this.users = this.users.filter(u => u.id !== userId);
                this.saveAllData();
            }

            updateParcelStatus(parcelId, newStatus) {
                const parcel = this.parcels.find(p => p.id === parcelId);
                if (parcel) {
                    parcel.status = newStatus;
                    parcel.lastUpdated = new Date().toISOString();
                    this.addNotification(parcel.userId, `Parcel ${parcel.id} status updated to: ${newStatus}`);
                    this.saveAllData();
                }
            }
        }

        // Advanced Form Validation System
        class FormValidator {
            static validateEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            static validatePhone(phone) {
                const phoneRegex = /^[6-9]\d{9}$/;
                return phoneRegex.test(phone.replace(/\D/g, ''));
            }

            static validatePassword(password) {
                return {
                    length: password.length >= 8,
                    uppercase: /[A-Z]/.test(password),
                    lowercase: /[a-z]/.test(password),
                    number: /\d/.test(password),
                    special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
                };
            }

            static showFieldError(fieldId, message) {
                const field = document.getElementById(fieldId);
                const existingError = field.parentNode.querySelector('.field-error');
                if (existingError) existingError.remove();

                const errorDiv = document.createElement('div');
                errorDiv.className = 'field-error';
                errorDiv.style.cssText = 'color: #dc3545; font-size: 12px; margin-top: 4px;';
                errorDiv.textContent = message;
                field.parentNode.appendChild(errorDiv);
                field.style.borderColor = '#dc3545';
            }

            static clearFieldError(fieldId) {
                const field = document.getElementById(fieldId);
                const existingError = field.parentNode.querySelector('.field-error');
                if (existingError) existingError.remove();
                field.style.borderColor = '#e0e0e0';
            }
        }

        // Advanced Search and Filter System
        class SearchEngine {
            constructor() {
                this.searchIndex = new Map();
                this.buildSearchIndex();
            }

            buildSearchIndex() {
                // Index parcels for search
                api.parcels.forEach(parcel => {
                    const searchTerms = [
                        parcel.id,
                        parcel.senderCity,
                        parcel.receiverCity,
                        parcel.type,
                        parcel.status
                    ].join(' ').toLowerCase();
                    this.searchIndex.set(parcel.id, searchTerms);
                });
            }

            search(query) {
                const lowerQuery = query.toLowerCase();
                const results = [];
                
                this.searchIndex.forEach((terms, parcelId) => {
                    if (terms.includes(lowerQuery)) {
                        const parcel = api.parcels.find(p => p.id === parcelId);
                        if (parcel) results.push(parcel);
                    }
                });
                
                return results;
            }

            filterParcels(filters) {
                return api.parcels.filter(parcel => {
                    if (filters.status && parcel.status !== filters.status) return false;
                    if (filters.city && !parcel.senderCity.includes(filters.city) && !parcel.receiverCity.includes(filters.city)) return false;
                    if (filters.dateFrom && new Date(parcel.bookingDate) < new Date(filters.dateFrom)) return false;
                    if (filters.dateTo && new Date(parcel.bookingDate) > new Date(filters.dateTo)) return false;
                    return true;
                });
            }
        }

        // Real-time Price Calculator
        class PriceCalculator {
            constructor() {
                this.basePrices = {
                    'same-day': 200,
                    'express': 100,
                    'standard': 50
                };
                this.cityDistances = {
                    'Chennai': { 'Coimbatore': 500, 'Madurai': 460, 'Salem': 340 },
                    'Coimbatore': { 'Chennai': 500, 'Madurai': 210, 'Salem': 170 },
                    'Madurai': { 'Chennai': 460, 'Coimbatore': 210, 'Salem': 280 }
                };
                this.surgeMultiplier = 1.0;
            }

            calculateDistance(fromCity, toCity) {
                return this.cityDistances[fromCity]?.[toCity] || 300;
            }

            calculatePrice(weight, deliveryType, fromCity, toCity, isFragile = false) {
                let basePrice = this.basePrices[deliveryType] || 50;
                let weightCharge = weight > 1 ? (weight - 1) * 20 : 0;
                let distanceCharge = this.calculateDistance(fromCity, toCity) * 0.1;
                let fragileCharge = isFragile ? 50 : 0;
                
                let subtotal = basePrice + weightCharge + distanceCharge + fragileCharge;
                let total = subtotal * this.surgeMultiplier;
                
                return {
                    basePrice,
                    weightCharge,
                    distanceCharge,
                    fragileCharge,
                    surgeCharge: total - subtotal,
                    total: Math.round(total)
                };
            }

            updateSurgeMultiplier() {
                // Simulate dynamic pricing based on demand
                const hour = new Date().getHours();
                if (hour >= 9 && hour <= 18) {
                    this.surgeMultiplier = 1.2; // Peak hours
                } else {
                    this.surgeMultiplier = 1.0; // Normal hours
                }
            }
        }

        // Advanced Notification System
        class NotificationManager {
            constructor() {
                this.notifications = [];
                this.initializeNotifications();
            }

            initializeNotifications() {
                if (api.currentUser) {
                    this.loadUserNotifications();
                    this.createNotificationBell();
                }
            }

            loadUserNotifications() {
                this.notifications = api.notifications.filter(n => n.userId === api.currentUser.id);
            }

            createNotificationBell() {
                // Check if notification bell already exists
                if (document.getElementById('notificationBadge')) {
                    this.updateNotificationBadge();
                    return;
                }
                
                const headerActions = document.querySelector('.header-actions');
                const bellContainer = document.createElement('div');
                bellContainer.style.position = 'relative';
                bellContainer.innerHTML = `
                    <button class="header-btn" onclick="notificationManager.toggleNotifications()">
                        <span>üîî</span>
                        <span class="notification-badge" id="notificationBadge" style="
                            position: absolute;
                            top: -5px;
                            right: -5px;
                            background: #ff6161;
                            color: white;
                            border-radius: 50%;
                            width: 18px;
                            height: 18px;
                            font-size: 10px;
                            display: none;
                            align-items: center;
                            justify-content: center;
                        "></span>
                    </button>
                    <div class="notification-dropdown" id="notificationDropdown" style="
                        position: absolute;
                        top: 100%;
                        right: 0;
                        background: white;
                        border-radius: 8px;
                        box-shadow: 0 8px 32px rgba(0,0,0,0.2);
                        min-width: 320px;
                        max-height: 400px;
                        overflow-y: auto;
                        display: none;
                        z-index: 1001;
                    "></div>
                `;
                headerActions.insertBefore(bellContainer, headerActions.firstChild);
                this.updateNotificationBadge();
            }

            toggleNotifications() {
                const dropdown = document.getElementById('notificationDropdown');
                const isVisible = dropdown.style.display === 'block';
                
                if (isVisible) {
                    dropdown.style.display = 'none';
                } else {
                    this.renderNotifications();
                    dropdown.style.display = 'block';
                }
            }

            renderNotifications() {
                const dropdown = document.getElementById('notificationDropdown');
                const unreadNotifications = this.notifications.filter(n => !n.read).slice(0, 10);
                
                if (unreadNotifications.length === 0) {
                    dropdown.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: #696969;">
                            No new notifications
                        </div>
                    `;
                } else {
                    dropdown.innerHTML = `
                        <div style="padding: 16px; border-bottom: 1px solid #e0e0e0; font-weight: 500;">
                            Notifications (${unreadNotifications.length})
                        </div>
                        ${unreadNotifications.map(notification => `
                            <div class="notification-item" style="
                                padding: 12px 16px;
                                border-bottom: 1px solid #f0f0f0;
                                cursor: pointer;
                                transition: background-color 0.2s;
                            " onclick="notificationManager.markAsRead('${notification.id}')">
                                <div style="font-size: 14px; color: #212121; margin-bottom: 4px;">
                                    ${notification.message}
                                </div>
                                <div style="font-size: 12px; color: #696969;">
                                    ${new Date(notification.timestamp).toLocaleString()}
                                </div>
                            </div>
                        `).join('')}
                        <div style="padding: 12px 16px; text-align: center;">
                            <button onclick="notificationManager.markAllAsRead()" style="
                                background: none;
                                border: none;
                                color: #2874f0;
                                cursor: pointer;
                                font-size: 14px;
                            ">Mark all as read</button>
                        </div>
                    `;
                }
            }

            markAsRead(notificationId) {
                const notification = api.notifications.find(n => n.id == notificationId);
                if (notification) {
                    notification.read = true;
                    api.saveAllData();
                    this.loadUserNotifications();
                    this.updateNotificationBadge();
                }
            }

            markAllAsRead() {
                api.notifications.forEach(n => {
                    if (n.userId === api.currentUser.id) n.read = true;
                });
                api.saveAllData();
                this.loadUserNotifications();
                this.updateNotificationBadge();
                document.getElementById('notificationDropdown').style.display = 'none';
            }

            updateNotificationBadge() {
                const badge = document.getElementById('notificationBadge');
                if (badge) {
                    const unreadCount = this.notifications.filter(n => !n.read).length;
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                }
            }
        }

        // Initialize enhanced systems
        const api = new DigiPostAPI();
        const searchEngine = new SearchEngine();
        const priceCalculator = new PriceCalculator();
        let notificationManager;

        // Legacy variables for compatibility
        let users = api.users;
        let currentUser = api.currentUser;
        let parcels = api.parcels;

        // Enhanced Search Functions
        function handleGlobalSearch(event) {
            const query = event.target.value.trim();
            const resultsDiv = document.getElementById('searchResults');
            
            if (query.length < 2) {
                resultsDiv.style.display = 'none';
                return;
            }
            
            const results = searchEngine.search(query);
            displaySearchResults(results);
        }

        function performGlobalSearch() {
            const query = document.getElementById('globalSearch').value.trim();
            if (query) {
                const results = searchEngine.search(query);
                displaySearchResults(results);
            }
        }

        function displaySearchResults(results) {
            const resultsDiv = document.getElementById('searchResults');
            
            if (results.length === 0) {
                resultsDiv.innerHTML = `
                    <div style="padding: 16px; text-align: center; color: #696969;">
                        No results found
                    </div>
                `;
            } else {
                resultsDiv.innerHTML = results.slice(0, 5).map(parcel => `
                    <div style="
                        padding: 12px 16px;
                        border-bottom: 1px solid #f0f0f0;
                        cursor: pointer;
                        transition: background-color 0.2s;
                    " onclick="viewParcelDetails('${parcel.id}')" onmouseover="this.style.backgroundColor='#f8f9fa'" onmouseout="this.style.backgroundColor='white'">
                        <div style="font-weight: 500; color: #212121;">${parcel.id}</div>
                        <div style="font-size: 12px; color: #696969;">${parcel.senderCity} ‚Üí ${parcel.receiverCity}</div>
                        <div style="font-size: 12px; color: #2874f0;">${parcel.status}</div>
                    </div>
                `).join('');
            }
            
            resultsDiv.style.display = 'block';
        }

        function viewParcelDetails(parcelId) {
            document.getElementById('trackingNumber').value = parcelId;
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('globalSearch').value = '';
            showPage('tracking');
            handleTracking({ preventDefault: () => {} });
        }

        // Hide search results when clicking outside
        document.addEventListener('click', function(event) {
            const searchContainer = document.querySelector('.search-container');
            const resultsDiv = document.getElementById('searchResults');
            
            if (!searchContainer.contains(event.target)) {
                resultsDiv.style.display = 'none';
            }
        });

        // Customer Query Functions
        function handleCustomerQuery(event) {
            event.preventDefault();
            
            if (!currentUser) {
                showNotification('Please login to submit a query', 'error');
                showPage('login');
                return;
            }
            
            const formData = new FormData(event.target);
            const queryData = {
                userId: currentUser.id,
                userName: currentUser.name,
                userEmail: currentUser.email,
                userPhone: currentUser.phone,
                subject: formData.get('subject'),
                parcelId: formData.get('parcelId') || 'N/A',
                message: formData.get('message'),
                contactPreference: formData.get('contactPreference')
            };
            
            api.addQuery(queryData);
            
            // Reset form
            document.getElementById('customerQueryForm').reset();
            
            showNotification('Your query has been submitted successfully! We will respond within 24 hours.', 'success');
            showPage('myQueries');
            loadUserQueries();
        }

        function loadUserQueries() {
            if (!currentUser) {
                showPage('login');
                return;
            }
            
            const container = document.getElementById('userQueriesList');
            const userQueries = api.queries.filter(q => q.userId === currentUser.id);
            
            if (userQueries.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="font-size: 64px; margin-bottom: 16px;">ÔøΩÔøΩÔøΩ</div>
                        <h3 style="color: #212121; margin-bottom: 8px;">No Queries Yet</h3>
                        <p style="color: #696969; margin-bottom: 24px;">You haven't submitted any queries. If you're facing any issues, feel free to report them!</p>
                        <button class="btn btn-primary" onclick="showPage('customerQuery')">Report an Issue</button>
                    </div>
                `;
                return;
            }
            
            // Sort queries by date (newest first)
            userQueries.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            container.innerHTML = userQueries.map(query => `
                <div class="query-card ${query.status}" style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                        <div>
                            <div style="font-size: 18px; font-weight: 500; color: #212121; margin-bottom: 4px;">
                                ${query.subject}
                            </div>
                            <div style="color: #696969; font-size: 14px;">
                                Query ID: #${query.id} | ${query.parcelId !== 'N/A' ? 'Parcel: ' + query.parcelId : 'General Query'}
                            </div>
                            <div style="color: #696969; font-size: 12px; margin-top: 4px;">
                                Submitted: ${new Date(query.timestamp).toLocaleString()}
                            </div>
                        </div>
                        <span style="
                            padding: 6px 12px;
                            border-radius: 12px;
                            font-size: 12px;
                            text-transform: uppercase;
                            font-weight: 500;
                            ${query.status === 'pending' ? 'background: #fff3cd; color: #856404;' : 'background: #d4edda; color: #155724;'}
                        ">
                            ${query.status}
                        </span>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 4px; margin-bottom: 12px;">
                        <strong style="font-size: 14px;">Your Message:</strong>
                        <div style="color: #696969; margin-top: 4px; font-size: 14px;">${query.message}</div>
                    </div>
                    
                    ${query.response ? `
                        <div style="background: #e8f5e8; padding: 12px; border-radius: 4px; border-left: 4px solid #4caf50; margin-bottom: 12px;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <span style="font-size: 16px;">‚úì</span>
                                <strong style="font-size: 14px; color: #2e7d32;">Support Team Response:</strong>
                            </div>
                            <div style="color: #1b5e20; font-size: 14px;">${query.response}</div>
                            ${query.resolvedAt ? `
                                <div style="color: #2e7d32; font-size: 12px; margin-top: 8px;">
                                    Resolved: ${new Date(query.resolvedAt).toLocaleString()}
                                </div>
                            ` : ''}
                        </div>
                    ` : `
                        <div style="background: #fff3e0; padding: 12px; border-radius: 4px; border-left: 4px solid #ff9800;">
                            <div style="color: #e65100; font-size: 14px;">
                                ‚è±Ô∏è Your query is being reviewed by our support team. We'll respond within 24 hours.
                            </div>
                        </div>
                    `}
                    
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e0e0e0; font-size: 12px; color: #696969;">
                        <strong>Contact Preference:</strong> ${query.contactPreference.charAt(0).toUpperCase() + query.contactPreference.slice(1)}
                    </div>
                </div>
            `).join('');
        }

        // Admin Functions
        function handleAdminLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            
            // Check admin credentials
            if (email === 'admin@digipost.com' && password === 'admin123') {
                api.isAdmin = true;
                localStorage.setItem('isAdmin', JSON.stringify(true));
                showPage('adminDashboard');
                loadAdminDashboard();
                showNotification('Admin login successful!', 'success');
            } else {
                showNotification('Invalid admin credentials!', 'error');
            }
        }

        function adminLogout() {
            api.isAdmin = false;
            localStorage.setItem('isAdmin', JSON.stringify(false));
            showPage('home');
            showNotification('Admin logged out successfully!', 'success');
        }

        function loadAdminDashboard() {
            // Update admin stats
            document.getElementById('adminTotalParcels').textContent = api.parcels.length;
            document.getElementById('adminTotalUsers').textContent = api.users.length;
            document.getElementById('adminPendingDeliveries').textContent = api.parcels.filter(p => p.status !== 'Delivered').length;
            document.getElementById('adminTotalQueries').textContent = api.queries.filter(q => q.status === 'pending').length;
            
            // Load parcels by default
            loadAdminParcels();
        }

        function showAdminTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Hide all tab contents
            document.querySelectorAll('.admin-tab-content').forEach(content => content.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(`admin${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`).classList.add('active');
            
            // Load data for selected tab
            if (tabName === 'parcels') loadAdminParcels();
            else if (tabName === 'users') loadAdminUsers();
            else if (tabName === 'queries') loadAdminQueries();
        }

        function loadAdminParcels() {
            const container = document.getElementById('adminParcelsList');
            const filter = document.getElementById('parcelStatusFilter')?.value || '';
            
            let parcelsToShow = api.parcels;
            if (filter) {
                parcelsToShow = api.parcels.filter(p => p.status === filter);
            }
            
            if (parcelsToShow.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #696969;">No parcels found</div>';
                return;
            }
            
            container.innerHTML = parcelsToShow.map(parcel => {
                const user = api.users.find(u => u.id === parcel.userId);
                return `
                    <div class="parcel-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                            <div>
                                <div style="font-size: 18px; font-weight: 500; color: #212121; margin-bottom: 4px;">
                                    ${parcel.id}
                                </div>
                                <div style="color: #696969; font-size: 14px;">
                                    Customer: ${user?.name || 'Unknown'} (${user?.email || 'N/A'})
                                </div>
                            </div>
                            <div>
                                <select class="form-select" onchange="updateParcelStatus('${parcel.id}', this.value)" style="width: auto;">
                                    <option value="Processing" ${parcel.status === 'Processing' ? 'selected' : ''}>Processing</option>
                                    <option value="Picked Up" ${parcel.status === 'Picked Up' ? 'selected' : ''}>Picked Up</option>
                                    <option value="In Transit" ${parcel.status === 'In Transit' ? 'selected' : ''}>In Transit</option>
                                    <option value="Out for Delivery" ${parcel.status === 'Out for Delivery' ? 'selected' : ''}>Out for Delivery</option>
                                    <option value="Delivered" ${parcel.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 12px;">
                            <div>
                                <strong>From:</strong> ${parcel.senderCity}<br>
                                <span style="font-size: 14px; color: #696969;">${parcel.senderName} - ${parcel.senderPhone}</span>
                            </div>
                            <div>
                                <strong>To:</strong> ${parcel.receiverCity}<br>
                                <span style="font-size: 14px; color: #696969;">${parcel.receiverName} - ${parcel.receiverPhone}</span>
                            </div>
                            <div>
                                <strong>Weight:</strong> ${parcel.weight} kg<br>
                                <strong>Type:</strong> ${parcel.type}
                            </div>
                            <div>
                                <strong>Booked:</strong><br>
                                <span style="font-size: 14px; color: #696969;">${new Date(parcel.bookingDate).toLocaleString()}</span>
                            </div>
                        </div>
                        
                        ${parcel.messageToRecipient ? `
                            <div style="background: #f8f9fa; padding: 12px; border-radius: 4px; margin-top: 12px;">
                                <strong style="font-size: 14px;">üí¨ Message:</strong>
                                <div style="color: #696969; font-size: 14px; margin-top: 4px;">"${parcel.messageToRecipient}"</div>
                            </div>
                        ` : ''}
                        
                        <div style="margin-top: 16px; display: flex; gap: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" ${parcel.status === 'Delivered' ? 'checked' : ''} 
                                    onchange="markAsDelivered('${parcel.id}', this.checked)">
                                <span style="font-size: 14px;">Mark as Delivered</span>
                            </label>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterAdminParcels() {
            loadAdminParcels();
        }

        function updateParcelStatus(parcelId, newStatus) {
            api.updateParcelStatus(parcelId, newStatus);
            showNotification(`Parcel ${parcelId} status updated to ${newStatus}`, 'success');
            loadAdminParcels();
            
            // Update stats
            document.getElementById('adminPendingDeliveries').textContent = api.parcels.filter(p => p.status !== 'Delivered').length;
        }

        function markAsDelivered(parcelId, isDelivered) {
            if (isDelivered) {
                api.updateParcelStatus(parcelId, 'Delivered');
                showNotification(`Parcel ${parcelId} marked as delivered!`, 'success');
            }
            loadAdminParcels();
        }

        function loadAdminUsers() {
            const container = document.getElementById('adminUsersList');
            
            if (api.users.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #696969;">No users registered yet</div>';
                return;
            }
            
            container.innerHTML = api.users.map(user => {
                const userParcels = api.parcels.filter(p => p.userId === user.id);
                return `
                    <div class="user-card">
                        <div>
                            <div style="font-size: 18px; font-weight: 500; color: #212121;">${user.name}</div>
                            <div style="color: #696969; font-size: 14px; margin-top: 4px;">
                                üìß ${user.email} | üìû ${user.phone}
                            </div>
                            <div style="color: #696969; font-size: 14px; margin-top: 4px;">
                                üìç ${user.city} | Joined: ${new Date(user.joinDate).toLocaleDateString()}
                            </div>
                            <div style="margin-top: 8px;">
                                <span style="background: #e8f5e8; color: #2e7d32; padding: 4px 12px; border-radius: 12px; font-size: 12px;">
                                    ${userParcels.length} Parcels
                                </span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-primary" onclick="downloadUserDetailsPDF(${user.id})" style="font-size: 12px; padding: 8px 16px;">
                                üì• Download PDF
                            </button>
                            <button class="btn btn-secondary" onclick="viewUserDetails(${user.id})" style="font-size: 12px; padding: 8px 16px;">
                                View Details
                            </button>
                            <button class="btn" onclick="deleteUserAccount(${user.id})" style="
                                background: #dc3545;
                                color: white;
                                font-size: 12px;
                                padding: 8px 16px;
                            ">
                                Delete User
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function searchUsers() {
            const searchTerm = document.getElementById('userSearchInput').value.toLowerCase();
            const container = document.getElementById('adminUsersList');
            
            const filteredUsers = api.users.filter(user => 
                user.name.toLowerCase().includes(searchTerm) ||
                user.email.toLowerCase().includes(searchTerm) ||
                user.phone.includes(searchTerm) ||
                user.city.toLowerCase().includes(searchTerm)
            );
            
            if (filteredUsers.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #696969;">No users found</div>';
                return;
            }
            
            container.innerHTML = filteredUsers.map(user => {
                const userParcels = api.parcels.filter(p => p.userId === user.id);
                return `
                    <div class="user-card">
                        <div>
                            <div style="font-size: 18px; font-weight: 500; color: #212121;">${user.name}</div>
                            <div style="color: #696969; font-size: 14px; margin-top: 4px;">
                                üìß ${user.email} | üìû ${user.phone}
                            </div>
                            <div style="color: #696969; font-size: 14px; margin-top: 4px;">
                                üìç ${user.city} | Joined: ${new Date(user.joinDate).toLocaleDateString()}
                            </div>
                            <div style="margin-top: 8px;">
                                <span style="background: #e8f5e8; color: #2e7d32; padding: 4px 12px; border-radius: 12px; font-size: 12px;">
                                    ${userParcels.length} Parcels
                                </span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-primary" onclick="downloadUserDetailsPDF(${user.id})" style="font-size: 12px; padding: 8px 16px;">
                                üì• Download PDF
                            </button>
                            <button class="btn btn-secondary" onclick="viewUserDetails(${user.id})" style="font-size: 12px; padding: 8px 16px;">
                                View Details
                            </button>
                            <button class="btn" onclick="deleteUserAccount(${user.id})" style="
                                background: #dc3545;
                                color: white;
                                font-size: 12px;
                                padding: 8px 16px;
                            ">
                                Delete User
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function viewUserDetails(userId) {
            const user = api.users.find(u => u.id === userId);
            const userParcels = api.parcels.filter(p => p.userId === userId);
            
            const detailsHTML = `
                <div style="background: white; padding: 24px; border-radius: 8px; max-width: 600px; margin: 0 auto;">
                    <h3 style="margin: 0 0 20px 0;">User Details: ${user.name}</h3>
                    <div style="margin-bottom: 16px;">
                        <strong>Email:</strong> ${user.email}<br>
                        <strong>Phone:</strong> ${user.phone}<br>
                        <strong>City:</strong> ${user.city}<br>
                        <strong>Joined:</strong> ${new Date(user.joinDate).toLocaleString()}
                    </div>
                    <h4 style="margin: 20px 0 12px 0;">Parcel History (${userParcels.length})</h4>
                    ${userParcels.map(p => `
                        <div style="border: 1px solid #e0e0e0; padding: 12px; margin-bottom: 8px; border-radius: 4px;">
                            <strong>${p.id}</strong> - ${p.senderCity} ‚Üí ${p.receiverCity}<br>
                            <span style="font-size: 14px; color: #696969;">Status: ${p.status}</span>
                        </div>
                    `).join('') || '<div style="color: #696969;">No parcels yet</div>'}
                    <button class="btn btn-primary" onclick="loadAdminUsers()" style="margin-top: 16px;">Close</button>
                </div>
            `;
            
            document.getElementById('adminUsersList').innerHTML = detailsHTML;
        }

        function deleteUserAccount(userId) {
            const user = api.users.find(u => u.id === userId);
            
            // Create custom confirmation dialog
            const confirmDialog = document.createElement('div');
            confirmDialog.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            confirmDialog.innerHTML = `
                <div style="background: white; padding: 32px; border-radius: 8px; max-width: 400px; text-align: center;">
                    <h3 style="margin: 0 0 16px 0; color: #dc3545;">Delete User Account</h3>
                    <p style="color: #696969; margin-bottom: 24px;">
                        Are you sure you want to delete <strong>${user.name}</strong>?<br>
                        This action cannot be undone.
                    </p>
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button class="btn btn-secondary" onclick="this.closest('div').parentElement.remove()">
                            Cancel
                        </button>
                        <button class="btn" style="background: #dc3545; color: white;" onclick="confirmDeleteUser(${userId}, this)">
                            Delete User
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmDialog);
        }

        function confirmDeleteUser(userId, button) {
            const user = api.users.find(u => u.id === userId);
            api.deleteUser(userId);
            
            // Update stats
            document.getElementById('adminTotalUsers').textContent = api.users.length;
            
            showNotification(`User ${user.name} deleted successfully!`, 'success');
            
            // Close dialog
            button.closest('div').parentElement.remove();
            
            // Reload users list
            loadAdminUsers();
        }

        function downloadUserDetailsPDF(userId) {
            const user = api.users.find(u => u.id === userId);
            if (!user) {
                showNotification('User not found!', 'error');
                return;
            }
            
            showNotification('Generating user details PDF...', 'info');
            
            setTimeout(() => {
                generateUserDetailsPDF(user);
                showNotification('User details downloaded successfully!', 'success');
            }, 1000);
        }

        function generateUserDetailsPDF(user) {
            const userParcels = api.parcels.filter(p => p.userId === user.id);
            const userQueries = api.queries.filter(q => q.userId === user.id);
            const reportDate = new Date().toLocaleString();
            
            // Calculate user statistics
            const totalSpent = userParcels.reduce((sum, p) => sum + (p.cost || 150), 0);
            const deliveredParcels = userParcels.filter(p => p.status === 'Delivered').length;
            const pendingParcels = userParcels.filter(p => p.status !== 'Delivered').length;
            
            // Create detailed PDF content
            const pdfContent = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                     DIGI POST                              ‚ïë
‚ïë           USER DETAILS REPORT                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïêÔøΩÔøΩ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

Report Generated: ${reportDate}
User ID: ${user.id}

ÔøΩÔøΩ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

PERSONAL INFORMATION:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Full Name:        ${user.name}
Email Address:    ${user.email}
Phone Number:     ${user.phone}
City:             ${user.city}
Registration:     ${new Date(user.joinDate).toLocaleDateString()}
Account Status:   Active ‚úì

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄÔøΩÔøΩ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

ACCOUNT STATISTICS:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Total Parcels:    ${userParcels.length}
Delivered:        ${deliveredParcels}
In Progress:      ${pendingParcels}
Total Spent:      ‚Çπ${totalSpent}.00
Customer Queries: ${userQueries.length}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

PARCEL HISTORY:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄÔøΩÔøΩ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
${userParcels.length > 0 ? userParcels.map((parcel, index) => `
${index + 1}. Parcel ID: ${parcel.id}
   Route: ${parcel.senderCity} ‚Üí ${parcel.receiverCity}
   Status: ${parcel.status}
   Weight: ${parcel.weight} kg
   Type: ${parcel.type}
   Booked: ${new Date(parcel.bookingDate).toLocaleDateString()}
   ${parcel.messageToRecipient ? `Message: "${parcel.messageToRecipient}"` : ''}
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄÔøΩÔøΩÔøΩ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄÔøΩÔøΩ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
`).join('') : 'No parcel history available.\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ'}

CUSTOMER QUERIES:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄÔøΩÔøΩ‚îÄ‚îÄÔøΩÔøΩÔøΩ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
${userQueries.length > 0 ? userQueries.map((query, index) => `
${index + 1}. Query ID: ${query.id}
   Subject: ${query.subject}
   Status: ${query.status.toUpperCase()}
   Date: ${new Date(query.timestamp).toLocaleDateString()}
   Message: ${query.message}
   ${query.response ? `Response: ${query.response}` : 'Status: Pending review'}
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
`).join('') : 'No queries submitted.\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ'}

DELIVERY PREFERENCES:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Most Used Route:  ${getMostUsedRoute(userParcels)}
Preferred City:   ${user.city}
Avg. Parcel Weight: ${getAverageWeight(userParcels)} kg
Most Common Type: ${getMostCommonType(userParcels)}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄÔøΩÔøΩÔøΩ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

CONTACT INFORMATION:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Primary Email:    ${user.email}
Mobile Number:    ${user.phone}
Registered City:  ${user.city}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

NOTES:
This report contains confidential user information and should
be handled according to DIGI POST privacy policies.

For support or queries, contact:
Phone: 1800-DIGI-POST
Email: admin@digipost.com

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄÔøΩÔøΩÔøΩ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
           Report Generated by DIGI POST Admin Panel
                ${new Date().toLocaleDateString()}
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïêÔøΩÔøΩÔøΩ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
            `;
            
            // Create and download the file
            const blob = new Blob([pdfContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `DIGIPOST_User_${user.name.replace(/\s+/g, '_')}_${user.id}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function getMostUsedRoute(parcels) {
            if (parcels.length === 0) return 'N/A';
            const routes = {};
            parcels.forEach(p => {
                const route = `${p.senderCity} ‚Üí ${p.receiverCity}`;
                routes[route] = (routes[route] || 0) + 1;
            });
            return Object.keys(routes).reduce((a, b) => routes[a] > routes[b] ? a : b, 'N/A');
        }

        function getAverageWeight(parcels) {
            if (parcels.length === 0) return '0';
            const totalWeight = parcels.reduce((sum, p) => sum + parseFloat(p.weight || 0), 0);
            return (totalWeight / parcels.length).toFixed(1);
        }

        function getMostCommonType(parcels) {
            if (parcels.length === 0) return 'N/A';
            const types = {};
            parcels.forEach(p => {
                types[p.type] = (types[p.type] || 0) + 1;
            });
            return Object.keys(types).reduce((a, b) => types[a] > types[b] ? a : b, 'N/A');
        }

        function loadAdminQueries() {
            const container = document.getElementById('adminQueriesList');
            const filter = document.getElementById('queryStatusFilter')?.value || '';
            
            let queriesToShow = api.queries;
            if (filter) {
                queriesToShow = api.queries.filter(q => q.status === filter);
            }
            
            if (queriesToShow.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #696969;">No customer queries found</div>';
                return;
            }
            
            container.innerHTML = queriesToShow.map(query => `
                <div class="query-card ${query.status}">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                        <div>
                            <div style="font-size: 16px; font-weight: 500; color: #212121;">${query.subject}</div>
                            <div style="color: #696969; font-size: 14px; margin-top: 4px;">
                                From: ${query.userName} (${query.userEmail})
                            </div>
                            <div style="color: #696969; font-size: 12px; margin-top: 2px;">
                                ${new Date(query.timestamp).toLocaleString()}
                            </div>
                        </div>
                        <span style="
                            padding: 4px 12px;
                            border-radius: 12px;
                            font-size: 12px;
                            text-transform: uppercase;
                            ${query.status === 'pending' ? 'background: #fff3cd; color: #856404;' : 'background: #d4edda; color: #155724;'}
                        ">
                            ${query.status}
                        </span>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 4px; margin-bottom: 12px;">
                        <strong style="font-size: 14px;">Query:</strong>
                        <div style="color: #696969; margin-top: 4px;">${query.message}</div>
                    </div>
                    
                    ${query.response ? `
                        <div style="background: #e8f5e8; padding: 12px; border-radius: 4px; margin-bottom: 12px;">
                            <strong style="font-size: 14px; color: #2e7d32;">Admin Response:</strong>
                            <div style="color: #1b5e20; margin-top: 4px;">${query.response}</div>
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 8px;">
                        ${query.status === 'pending' ? `
                            <button class="btn btn-success" onclick="respondToQuery(${query.id})" style="font-size: 12px; padding: 8px 16px;">
                                Respond & Resolve
                            </button>
                        ` : ''}
                        <button class="btn btn-secondary" onclick="deleteQuery(${query.id})" style="font-size: 12px; padding: 8px 16px;">
                            Delete Query
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function filterQueries() {
            loadAdminQueries();
        }

        function respondToQuery(queryId) {
            const query = api.queries.find(q => q.id === queryId);
            
            const responseDialog = document.createElement('div');
            responseDialog.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            responseDialog.innerHTML = `
                <div style="background: white; padding: 32px; border-radius: 8px; max-width: 500px; width: 90%;">
                    <h3 style="margin: 0 0 16px 0;">Respond to Query</h3>
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 4px; margin-bottom: 16px;">
                        <strong>Original Query:</strong>
                        <div style="color: #696969; margin-top: 4px;">${query.message}</div>
                    </div>
                    <textarea id="queryResponse" class="form-textarea" placeholder="Type your response..." style="min-height: 120px; margin-bottom: 16px;"></textarea>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-secondary" onclick="this.closest('div').parentElement.remove()">
                            Cancel
                        </button>
                        <button class="btn btn-success" onclick="submitQueryResponse(${queryId}, this)">
                            Send & Resolve
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(responseDialog);
        }

        function submitQueryResponse(queryId, button) {
            const response = document.getElementById('queryResponse').value.trim();
            
            if (!response) {
                showNotification('Please enter a response', 'error');
                return;
            }
            
            api.updateQueryStatus(queryId, 'resolved', response);
            
            // Update stats
            document.getElementById('adminTotalQueries').textContent = api.queries.filter(q => q.status === 'pending').length;
            
            showNotification('Query resolved and response sent!', 'success');
            
            // Close dialog
            button.closest('div').parentElement.remove();
            
            // Reload queries
            loadAdminQueries();
        }

        function deleteQuery(queryId) {
            api.queries = api.queries.filter(q => q.id !== queryId);
            api.saveAllData();
            
            showNotification('Query deleted successfully!', 'success');
            loadAdminQueries();
            
            // Update stats
            document.getElementById('adminTotalQueries').textContent = api.queries.filter(q => q.status === 'pending').length;
        }

        // Message Counter Function
        function updateMessageCounter() {
            const textarea = document.getElementById('messageToRecipient');
            const counter = document.getElementById('messageCounter');
            if (textarea && counter) {
                counter.textContent = textarea.value.length;
            }
        }

        // Price Calculator Functions
        function calculateShippingPrice() {
            const fromCity = document.getElementById('calcFromCity').value;
            const toCity = document.getElementById('calcToCity').value;
            const weight = parseFloat(document.getElementById('calcWeight').value) || 0;
            const deliveryType = document.getElementById('calcDeliveryType').value;
            const isFragile = document.getElementById('calcFragile').checked;
            
            if (!fromCity || !toCity || !weight || !deliveryType) {
                document.getElementById('calculatorResult').style.display = 'none';
                return;
            }
            
            const pricing = priceCalculator.calculatePrice(weight, deliveryType, fromCity, toCity, isFragile);
            const distance = priceCalculator.calculateDistance(fromCity, toCity);
            
            document.getElementById('calcDistance').textContent = `${distance} km`;
            document.getElementById('calcBaseCharge').textContent = `‚Çπ${pricing.basePrice}`;
            document.getElementById('calcWeightCharge').textContent = `‚Çπ${pricing.weightCharge}`;
            document.getElementById('calcDistanceCharge').textContent = `‚Çπ${Math.round(pricing.distanceCharge)}`;
            document.getElementById('calcAdditionalCharge').textContent = `‚Çπ${pricing.fragileCharge}`;
            document.getElementById('calcTotal').textContent = `‚Çπ${pricing.total}`;
            
            document.getElementById('calculatorResult').style.display = 'block';
        }

        function proceedToBookingFromCalculator() {
            const fromCity = document.getElementById('calcFromCity').value;
            const toCity = document.getElementById('calcToCity').value;
            const weight = document.getElementById('calcWeight').value;
            const deliveryType = document.getElementById('calcDeliveryType').value;
            
            showPage('booking');
            
            // Pre-fill booking form
            document.getElementById('senderCity').value = fromCity;
            document.getElementById('receiverCity').value = toCity;
            document.getElementById('parcelWeight').value = weight;
            document.getElementById('deliveryType').value = deliveryType;
            
            calculatePrice();
        }

        // Analytics Functions
        function loadAnalytics() {
            if (!currentUser) {
                showPage('login');
                return;
            }
            
            const userParcels = api.parcels.filter(p => p.userId === currentUser.id);
            const totalSpent = userParcels.reduce((sum, p) => sum + (p.cost || 150), 0);
            const avgCost = userParcels.length > 0 ? Math.round(totalSpent / userParcels.length) : 0;
            const deliveredOnTime = userParcels.filter(p => p.status === 'Delivered').length;
            const onTimePercentage = userParcels.length > 0 ? Math.round((deliveredOnTime / userParcels.length) * 100) : 0;
            
            document.getElementById('analyticsTotal').textContent = userParcels.length;
            document.getElementById('analyticsSpent').textContent = `‚Çπ${totalSpent}`;
            document.getElementById('analyticsAvgCost').textContent = `‚Çπ${avgCost}`;
            document.getElementById('analyticsOnTime').textContent = `${onTimePercentage}%`;
            
            // Load route statistics
            const routes = {};
            userParcels.forEach(p => {
                const route = `${p.senderCity} ‚Üí ${p.receiverCity}`;
                routes[route] = (routes[route] || 0) + 1;
            });
            
            const topRoutesHTML = Object.entries(routes)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([route, count]) => `
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                        <span>${route}</span>
                        <span style="font-weight: 500; color: #2874f0;">${count} parcels</span>
                    </div>
                `).join('') || '<div style="color: #696969; text-align: center; padding: 20px;">No data yet</div>';
            
            document.getElementById('topRoutes').innerHTML = topRoutesHTML;
            
            // Load parcel types
            const types = {};
            userParcels.forEach(p => {
                types[p.type] = (types[p.type] || 0) + 1;
            });
            
            const parcelTypesHTML = Object.entries(types)
                .sort((a, b) => b[1] - a[1])
                .map(([type, count]) => {
                    const percentage = Math.round((count / userParcels.length) * 100);
                    return `
                        <div style="margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span>${type}</span>
                                <span style="font-weight: 500;">${count} (${percentage}%)</span>
                            </div>
                            <div style="width: 100%; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden;">
                                <div style="width: ${percentage}%; height: 100%; background: #2874f0;"></div>
                            </div>
                        </div>
                    `;
                }).join('') || '<div style="color: #696969; text-align: center; padding: 20px;">No data yet</div>';
            
            document.getElementById('parcelTypes').innerHTML = parcelTypesHTML;
            
            // Load monthly chart
            loadMonthlyChart(userParcels);
        }

        function loadMonthlyChart(parcels) {
            const monthlyData = {};
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
            
            months.forEach(month => monthlyData[month] = 0);
            
            parcels.forEach(p => {
                const month = new Date(p.bookingDate).toLocaleString('en', { month: 'short' });
                if (monthlyData[month] !== undefined) {
                    monthlyData[month]++;
                }
            });
            
            const maxValue = Math.max(...Object.values(monthlyData), 1);
            
            const chartHTML = Object.entries(monthlyData).map(([month, count]) => {
                const height = (count / maxValue) * 180;
                return `
                    <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                        <div style="margin-bottom: 8px; font-weight: 500; color: #2874f0;">${count}</div>
                        <div style="width: 100%; background: #2874f0; border-radius: 4px 4px 0 0; transition: height 0.3s;" 
                             style="height: ${height}px; background: linear-gradient(to top, #2874f0, #64b5f6);"></div>
                        <div style="margin-top: 8px; font-size: 12px; color: #696969;">${month}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('monthlyChart').innerHTML = chartHTML;
        }

        // Bulk Booking Functions
        let bulkParcels = [];

        function addBulkParcelRow() {
            const parcelId = Date.now();
            bulkParcels.push({ id: parcelId });
            renderBulkParcels();
        }

        function renderBulkParcels() {
            const container = document.getElementById('bulkParcelsList');
            
            if (bulkParcels.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 8px; margin-bottom: 24px;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üì¶</div>
                        <p style="color: #696969;">No parcels added yet. Click the button below to start.</p>
                    </div>
                `;
                document.getElementById('bulkSummary').style.display = 'none';
                return;
            }
            
            container.innerHTML = bulkParcels.map((parcel, index) => `
                <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h4 style="margin: 0; color: #212121;">Parcel #${index + 1}</h4>
                        <button class="btn btn-secondary" onclick="removeBulkParcel(${parcel.id})" style="padding: 6px 12px; font-size: 12px;">
                            ‚úï Remove
                        </button>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">From City</label>
                            <select class="form-select" onchange="updateBulkSummary()">
                                <option value="">Select</option>
                                <option value="Chennai">Chennai</option>
                                <option value="Coimbatore">Coimbatore</option>
                                <option value="Madurai">Madurai</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">To City</label>
                            <select class="form-select" onchange="updateBulkSummary()">
                                <option value="">Select</option>
                                <option value="Chennai">Chennai</option>
                                <option value="Coimbatore">Coimbatore</option>
                                <option value="Madurai">Madurai</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Weight (kg)</label>
                            <input type="number" class="form-input" min="0.1" step="0.1" onchange="updateBulkSummary()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Receiver Name</label>
                            <input type="text" class="form-input">
                        </div>
                    </div>
                </div>
            `).join('');
            
            updateBulkSummary();
        }

        function removeBulkParcel(parcelId) {
            bulkParcels = bulkParcels.filter(p => p.id !== parcelId);
            renderBulkParcels();
        }

        function updateBulkSummary() {
            const count = bulkParcels.length;
            const subtotal = count * 150;
            let discount = 0;
            
            if (count >= 10) discount = subtotal * 0.20;
            else if (count >= 5) discount = subtotal * 0.10;
            
            const total = subtotal - discount;
            
            document.getElementById('bulkTotalParcels').textContent = count;
            document.getElementById('bulkSubtotal').textContent = `‚Çπ${subtotal}`;
            document.getElementById('bulkDiscount').textContent = `- ‚Çπ${discount}`;
            document.getElementById('bulkTotal').textContent = `‚Çπ${total}`;
            
            document.getElementById('bulkSummary').style.display = count > 0 ? 'block' : 'none';
        }

        function submitBulkBooking() {
            if (bulkParcels.length === 0) {
                showNotification('Please add at least one parcel', 'error');
                return;
            }
            
            showNotification('Processing bulk booking...', 'info');
            
            setTimeout(() => {
                showNotification(`Successfully booked ${bulkParcels.length} parcels!`, 'success');
                bulkParcels = [];
                renderBulkParcels();
                showPage('dashboard');
            }, 2000);
        }

        // Live Support Functions
        let liveChatMessages = [];

        function initializeLiveChat() {
            liveChatMessages = [
                { sender: 'support', message: 'Hello! How can I help you today?', time: new Date() }
            ];
            renderLiveChatMessages();
        }

        function renderLiveChatMessages() {
            const container = document.getElementById('liveChatMessages');
            container.innerHTML = liveChatMessages.map(msg => `
                <div style="margin-bottom: 16px; display: flex; ${msg.sender === 'user' ? 'justify-content: flex-end' : 'justify-content: flex-start'}">
                    <div style="
                        max-width: 70%;
                        padding: 12px 16px;
                        border-radius: 16px;
                        ${msg.sender === 'user' 
                            ? 'background: #2874f0; color: white; border-bottom-right-radius: 4px;' 
                            : 'background: white; color: #212121; border: 1px solid #e0e0e0; border-bottom-left-radius: 4px;'}
                    ">
                        <div style="font-size: 14px; line-height: 1.4; margin-bottom: 4px;">${msg.message}</div>
                        <div style="font-size: 10px; opacity: 0.7;">${msg.time.toLocaleTimeString()}</div>
                    </div>
                </div>
            `).join('');
            container.scrollTop = container.scrollHeight;
        }

        function sendLiveChatMessage() {
            const input = document.getElementById('liveChatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            liveChatMessages.push({ sender: 'user', message: message, time: new Date() });
            input.value = '';
            renderLiveChatMessages();
            
            // Simulate support response
            setTimeout(() => {
                const responses = [
                    'Thank you for your message. Let me check that for you.',
                    'I understand your concern. Let me help you with that.',
                    'Got it! I\'ll look into this right away.',
                    'That\'s a great question. Here\'s what I found...'
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                liveChatMessages.push({ sender: 'support', message: response, time: new Date() });
                renderLiveChatMessages();
            }, 1500);
        }

        function handleLiveChatKeypress(event) {
            if (event.key === 'Enter') {
                sendLiveChatMessage();
            }
        }

        function sendQuickMessage(message) {
            document.getElementById('liveChatInput').value = message;
            sendLiveChatMessage();
        }

        // Saved Addresses Functions
        let savedAddresses = JSON.parse(localStorage.getItem('savedAddresses')) || [];

        function showAddAddressForm() {
            document.getElementById('addAddressForm').style.display = 'block';
        }

        function hideAddAddressForm() {
            document.getElementById('addAddressForm').style.display = 'none';
            document.getElementById('newAddressForm').reset();
        }

        function saveNewAddress(event) {
            event.preventDefault();
            
            const newAddress = {
                id: Date.now(),
                label: document.getElementById('addressLabel').value,
                name: document.getElementById('addressName').value,
                phone: document.getElementById('addressPhone').value,
                city: document.getElementById('addressCity').value,
                fullAddress: document.getElementById('addressFull').value
            };
            
            savedAddresses.push(newAddress);
            localStorage.setItem('savedAddresses', JSON.stringify(savedAddresses));
            
            showNotification('Address saved successfully!', 'success');
            hideAddAddressForm();
            loadSavedAddresses();
        }

        function loadSavedAddresses() {
            const container = document.getElementById('savedAddressesList');
            
            if (savedAddresses.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 64px; margin-bottom: 16px;">ÔøΩÔøΩÔøΩÔøΩ</div>
                        <h3 style="color: #212121; margin-bottom: 8px;">No Saved Addresses</h3>
                        <p style="color: #696969;">Add your frequently used addresses for faster booking</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = savedAddresses.map(address => `
                <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <div style="display: inline-block; background: #2874f0; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; margin-bottom: 12px;">
                                ${address.label}
                            </div>
                            <div style="font-size: 18px; font-weight: 500; color: #212121; margin-bottom: 8px;">
                                ${address.name}
                            </div>
                            <div style="color: #696969; font-size: 14px; margin-bottom: 4px;">
                                üìû ${address.phone}
                            </div>
                            <div style="color: #696969; font-size: 14px; margin-bottom: 4px;">
                                üìç ${address.city}
                            </div>
                            <div style="color: #696969; font-size: 14px;">
                                ${address.fullAddress}
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-primary" onclick="useAddressForBooking(${address.id})" style="font-size: 12px; padding: 8px 16px;">
                                Use
                            </button>
                            <button class="btn btn-secondary" onclick="deleteSavedAddress(${address.id})" style="font-size: 12px; padding: 8px 16px; background: #dc3545; color: white;">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function deleteSavedAddress(addressId) {
            savedAddresses = savedAddresses.filter(a => a.id !== addressId);
            localStorage.setItem('savedAddresses', JSON.stringify(savedAddresses));
            showNotification('Address deleted successfully!', 'success');
            loadSavedAddresses();
        }

        function useAddressForBooking(addressId) {
            const address = savedAddresses.find(a => a.id === addressId);
            showPage('booking');
            
            // Pre-fill sender details
            document.getElementById('senderName').value = address.name;
            document.getElementById('senderPhone').value = address.phone;
            document.getElementById('senderCity').value = address.city;
            document.getElementById('senderAddress').value = address.fullAddress;
            
            showNotification('Address loaded into booking form', 'success');
        }

        // Profile Management Functions
        function loadProfile() {
            if (!currentUser) {
                showPage('login');
                return;
            }
            
            // Load profile data
            document.getElementById('profileName').value = currentUser.name || '';
            document.getElementById('profileEmail').value = currentUser.email || '';
            document.getElementById('profilePhone').value = currentUser.phone || '';
            document.getElementById('profileCity').value = currentUser.city || '';
            document.getElementById('profilePincode').value = currentUser.pincode || '';
            document.getElementById('profileAddress').value = currentUser.address || '';
            
            // Load profile picture
            if (currentUser.profilePicture) {
                document.getElementById('profilePicture').src = currentUser.profilePicture;
                document.getElementById('profilePicture').style.display = 'block';
                document.getElementById('profilePlaceholder').style.display = 'none';
            } else {
                const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
                document.getElementById('profilePlaceholder').textContent = initials;
                document.getElementById('profilePicture').style.display = 'none';
                document.getElementById('profilePlaceholder').style.display = 'flex';
            }
            
            // Set member since date
            const joinDate = new Date(currentUser.joinDate).toLocaleDateString('en-US', { 
                month: 'short', 
                year: 'numeric' 
            });
            document.getElementById('memberSince').textContent = joinDate;
        }

        function handleProfilePictureUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                showNotification('Please upload an image file', 'error');
                return;
            }
            
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('Image size should be less than 5MB', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageData = e.target.result;
                
                // Update current user
                currentUser.profilePicture = imageData;
                const userIndex = api.users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    api.users[userIndex].profilePicture = imageData;
                }
                api.currentUser = currentUser;
                api.saveAllData();
                
                // Update display
                document.getElementById('profilePicture').src = imageData;
                document.getElementById('profilePicture').style.display = 'block';
                document.getElementById('profilePlaceholder').style.display = 'none';
                
                showNotification('Profile picture updated successfully!', 'success');
            };
            
            reader.readAsDataURL(file);
        }

        function removeProfilePicture() {
            currentUser.profilePicture = null;
            const userIndex = api.users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                api.users[userIndex].profilePicture = null;
            }
            api.currentUser = currentUser;
            api.saveAllData();
            
            // Update display
            const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
            document.getElementById('profilePlaceholder').textContent = initials;
            document.getElementById('profilePicture').style.display = 'none';
            document.getElementById('profilePlaceholder').style.display = 'flex';
            
            showNotification('Profile picture removed', 'success');
        }

        function updateProfile(event) {
            event.preventDefault();
            
            // Validate email
            const email = document.getElementById('profileEmail').value;
            if (!FormValidator.validateEmail(email)) {
                showNotification('Please enter a valid email address', 'error');
                return;
            }
            
            // Validate phone
            const phone = document.getElementById('profilePhone').value;
            if (!FormValidator.validatePhone(phone)) {
                showNotification('Please enter a valid phone number', 'error');
                return;
            }
            
            // Update user data
            currentUser.name = document.getElementById('profileName').value;
            currentUser.email = email;
            currentUser.phone = phone;
            currentUser.city = document.getElementById('profileCity').value;
            currentUser.pincode = document.getElementById('profilePincode').value;
            currentUser.address = document.getElementById('profileAddress').value;
            
            // Update in users array
            const userIndex = api.users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                api.users[userIndex] = { ...api.users[userIndex], ...currentUser };
            }
            
            api.currentUser = currentUser;
            api.saveAllData();
            
            // Update header display
            document.getElementById('userMenuText').textContent = currentUser.name.split(' ')[0];
            
            showNotification('Profile updated successfully!', 'success');
        }

        function changePassword(event) {
            event.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Verify current password
            if (currentPassword !== currentUser.password) {
                showNotification('Current password is incorrect', 'error');
                return;
            }
            
            // Validate new password
            if (newPassword.length < 6) {
                showNotification('New password must be at least 6 characters long', 'error');
                return;
            }
            
            // Check if passwords match
            if (newPassword !== confirmPassword) {
                showNotification('New passwords do not match', 'error');
                return;
            }
            
            // Update password
            currentUser.password = newPassword;
            const userIndex = api.users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                api.users[userIndex].password = newPassword;
            }
            
            api.currentUser = currentUser;
            api.saveAllData();
            
            // Reset form
            document.getElementById('passwordForm').reset();
            
            showNotification('Password changed successfully!', 'success');
        }

        // Payment History Functions
        function loadPaymentHistory() {
            if (!currentUser) {
                showPage('login');
                return;
            }
            
            // Get user's payments
            const userPayments = api.parcels.filter(p => p.userId === currentUser.id && p.cost);
            
            // Calculate statistics
            const totalPaid = userPayments.reduce((sum, p) => sum + (p.cost || 0), 0);
            const pendingCount = api.parcels.filter(p => 
                p.userId === currentUser.id && p.status !== 'Delivered' && !p.paymentCompleted
            ).length;
            
            const lastPayment = userPayments.length > 0 
                ? new Date(userPayments[userPayments.length - 1].bookingDate).toLocaleDateString()
                : '-';
            
            document.getElementById('totalTransactions').textContent = userPayments.length;
            document.getElementById('totalAmountPaid').textContent = `‚Çπ${totalPaid}`;
            document.getElementById('pendingPayments').textContent = pendingCount;
            document.getElementById('lastPaymentDate').textContent = lastPayment;
            
            // Load payment list
            filterPayments();
        }

        function filterPayments() {
            const filter = document.getElementById('paymentFilter').value;
            const userPayments = api.parcels.filter(p => p.userId === currentUser.id && p.cost);
            
            let filteredPayments = userPayments;
            if (filter === 'completed') {
                filteredPayments = userPayments.filter(p => p.paymentCompleted);
            } else if (filter === 'pending') {
                filteredPayments = userPayments.filter(p => !p.paymentCompleted);
            }
            
            const container = document.getElementById('paymentHistoryList');
            
            if (filteredPayments.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="font-size: 64px; margin-bottom: 16px;">üí≥</div>
                        <h3 style="color: #212121; margin-bottom: 8px;">No Payments Found</h3>
                        <p style="color: #696969;">Your payment history will appear here</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredPayments.sort((a, b) => 
                new Date(b.bookingDate) - new Date(a.bookingDate)
            ).map(payment => `
                <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 16px; background: white;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                        <div>
                            <div style="font-size: 18px; font-weight: 500; color: #212121; margin-bottom: 4px;">
                                Parcel ${payment.id}
                            </div>
                            <div style="color: #696969; font-size: 14px;">
                                ${payment.senderCity} ‚Üí ${payment.receiverCity}
                            </div>
                            <div style="color: #696969; font-size: 12px; margin-top: 4px;">
                                ${new Date(payment.bookingDate).toLocaleString()}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 24px; font-weight: 500; color: #2874f0; margin-bottom: 4px;">
                                ‚Çπ${payment.cost}
                            </div>
                            <div style="
                                padding: 4px 12px;
                                border-radius: 12px;
                                font-size: 12px;
                                display: inline-block;
                                ${payment.paymentCompleted ? 'background: #d4edda; color: #155724;' : 'background: #fff3cd; color: #856404;'}
                            ">
                                ${payment.paymentCompleted ? 'Paid' : 'Pending'}
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; padding: 12px; background: #f8f9fa; border-radius: 4px; margin-bottom: 12px;">
                        <div>
                            <div style="font-size: 12px; color: #696969;">Weight</div>
                            <div style="font-weight: 500;">${payment.weight} kg</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #696969;">Type</div>
                            <div style="font-weight: 500;">${payment.type}</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #696969;">Delivery</div>
                            <div style="font-weight: 500;">${payment.deliveryType || 'Standard'}</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #696969;">Status</div>
                            <div style="font-weight: 500;">${payment.status}</div>
                        </div>
                    </div>
                    
                    ${payment.paymentMethod ? `
                        <div style="font-size: 14px; color: #696969; margin-bottom: 12px;">
                            <strong>Payment Method:</strong> ${payment.paymentMethod}
                            ${payment.transactionId ? ` | <strong>Transaction ID:</strong> ${payment.transactionId}` : ''}
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-primary" onclick="downloadPaymentReceipt('${payment.id}')" style="font-size: 12px; padding: 8px 16px;">
                            üì• Download Receipt
                        </button>
                        ${!payment.paymentCompleted ? `
                            <button class="btn btn-success" onclick="makePaymentForParcel('${payment.id}')" style="font-size: 12px; padding: 8px 16px;">
                                üí≥ Pay Now
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function downloadPaymentReceipt(parcelId) {
            const payment = api.parcels.find(p => p.id === parcelId);
            if (!payment) {
                showNotification('Payment record not found', 'error');
                return;
            }
            
            showNotification('Generating payment receipt...', 'info');
            
            setTimeout(() => {
                generatePaymentReceiptPDF(payment);
                showNotification('Receipt downloaded successfully!', 'success');
            }, 1000);
        }

        function generatePaymentReceiptPDF(payment) {
            const receiptDate = new Date().toLocaleString();
            const bookingDate = new Date(payment.bookingDate).toLocaleString();
            
            const receiptContent = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                     DIGI POST                              ‚ïë
‚ïë              PAYMENT RECEIPT                               ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

Receipt Date: ${receiptDate}
Receipt ID: RCP${payment.id}${Date.now().toString().slice(-4)}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

CUSTOMER INFORMATION:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Name:             ${currentUser.name}
Email:            ${currentUser.email}
Phone:            ${currentUser.phone}
City:             ${currentUser.city}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

PARCEL DETAILS:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Parcel ID:        ${payment.id}
Booking Date:     ${bookingDate}
Status:           ${payment.status}

FROM:
Name:             ${payment.senderName}
Phone:            ${payment.senderPhone}
City:             ${payment.senderCity}
Address:          ${payment.senderAddress}

TO:
Name:             ${payment.receiverName}
Phone:            ${payment.receiverPhone}
City:             ${payment.receiverCity}
Address:          ${payment.receiverAddress}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

SHIPMENT DETAILS:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Package Weight:   ${payment.weight} kg
Package Type:     ${payment.type}
Delivery Type:    ${payment.deliveryType || 'Standard'}
Fragile:          ${payment.fragileItem ? 'Yes' : 'No'}

${payment.messageToRecipient ? `
Special Instructions:
"${payment.messageToRecipient}"
` : ''}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

PAYMENT BREAKDOWN:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Base Charge:              ‚Çπ${Math.floor(payment.cost * 0.6)}
Weight Charge:            ‚Çπ${Math.floor(payment.cost * 0.3)}
Additional Charges:       ‚Çπ${Math.floor(payment.cost * 0.1)}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
TOTAL AMOUNT:             ‚Çπ${payment.cost}.00
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

Payment Status:           ${payment.paymentCompleted ? 'PAID ‚úì' : 'PENDING'}
${payment.paymentMethod ? `Payment Method:           ${payment.paymentMethod}` : ''}
${payment.transactionId ? `Transaction ID:           ${payment.transactionId}` : ''}
${payment.paymentDate ? `Payment Date:             ${new Date(payment.paymentDate).toLocaleString()}` : ''}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

TERMS & CONDITIONS:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. This receipt is valid for all official purposes
2. Please retain this receipt for future reference
3. For any queries, contact: 1800-DIGI-POST
4. Email: support@digipost.com
5. Refunds are processed within 7-10 business days

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

Thank you for choosing DIGI POST!
We appreciate your business and trust.

For tracking updates, visit: www.digipost.com
Customer Support: 1800-DIGI-POST (24/7)

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
              Generated by DIGI POST System
                    ${new Date().toLocaleDateString()}
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
            `;
            
            // Create and download the file
            const blob = new Blob([receiptContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `DIGIPOST_Receipt_${payment.id}_${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function downloadAllPaymentHistory() {
            if (!currentUser) return;
            
            const userPayments = api.parcels.filter(p => p.userId === currentUser.id && p.cost);
            
            if (userPayments.length === 0) {
                showNotification('No payment history to download', 'error');
                return;
            }
            
            showNotification('Generating payment history report...', 'info');
            
            setTimeout(() => {
                generatePaymentHistoryReport(userPayments);
                showNotification('Payment history downloaded successfully!', 'success');
            }, 1000);
        }

        function generatePaymentHistoryReport(payments) {
            const reportDate = new Date().toLocaleString();
            const totalPaid = payments.reduce((sum, p) => sum + (p.cost || 0), 0);
            const completedPayments = payments.filter(p => p.paymentCompleted).length;
            const pendingPayments = payments.length - completedPayments;
            
            const reportContent = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                     DIGI POST                              ‚ïë
‚ïë           PAYMENT HISTORY REPORT                           ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

Report Generated: ${reportDate}
Customer: ${currentUser.name}
Email: ${currentUser.email}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

PAYMENT SUMMARY:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Total Transactions:       ${payments.length}
Completed Payments:       ${completedPayments}
Pending Payments:         ${pendingPayments}
Total Amount Paid:        ‚Çπ${totalPaid}.00
Average Transaction:      ‚Çπ${Math.round(totalPaid / payments.length)}.00

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

DETAILED TRANSACTION HISTORY:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

${payments.sort((a, b) => new Date(b.bookingDate) - new Date(a.bookingDate)).map((payment, index) => `
${index + 1}. Parcel ID: ${payment.id}
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Date:             ${new Date(payment.bookingDate).toLocaleString()}
   Route:            ${payment.senderCity} ‚Üí ${payment.receiverCity}
   Amount:           ‚Çπ${payment.cost}.00
   Status:           ${payment.paymentCompleted ? 'PAID ‚úì' : 'PENDING ‚è±'}
   Delivery Status:  ${payment.status}
   Weight:           ${payment.weight} kg
   Type:             ${payment.type}
   ${payment.paymentMethod ? `Payment Method:   ${payment.paymentMethod}` : ''}
   ${payment.transactionId ? `Transaction ID:   ${payment.transactionId}` : ''}
   
   Sender:           ${payment.senderName} (${payment.senderPhone})
   Receiver:         ${payment.receiverName} (${payment.receiverPhone})
`).join('\n')}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

PAYMENT STATISTICS BY MONTH:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
${getMonthlyPaymentStats(payments)}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

PAYMENT METHODS USED:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
${getPaymentMethodStats(payments)}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

DELIVERY TYPE BREAKDOWN:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
${getDeliveryTypeStats(payments)}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

ROUTE ANALYSIS:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Most Frequent Route:      ${getMostFrequentRoute(payments)}
Total Unique Routes:      ${getUniqueRoutesCount(payments)}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

NOTES:
‚Ä¢ This report contains all payment transactions for your account
‚Ä¢ For any discrepancies, contact support@digipost.com
‚Ä¢ Keep this report for tax and accounting purposes
‚Ä¢ Refunds typically take 7-10 business days to process

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

CUSTOMER SUPPORT:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Phone:  1800-DIGI-POST (24/7)
Email:  support@digipost.com
Web:    www.digipost.com

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
           Report Generated by DIGI POST System
                 ${new Date().toLocaleDateString()}
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
            `;
            
            // Create and download the file
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `DIGIPOST_PaymentHistory_${currentUser.name.replace(/\s+/g, '_')}_${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function getMonthlyPaymentStats(payments) {
            const monthlyStats = {};
            payments.forEach(p => {
                const month = new Date(p.bookingDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
                if (!monthlyStats[month]) {
                    monthlyStats[month] = { count: 0, total: 0 };
                }
                monthlyStats[month].count++;
                monthlyStats[month].total += p.cost || 0;
            });
            
            return Object.entries(monthlyStats)
                .sort((a, b) => new Date(a[0]) - new Date(b[0]))
                .map(([month, stats]) => `${month}: ${stats.count} transactions, ‚Çπ${stats.total}.00`)
                .join('\n') || 'No data available';
        }

        function getPaymentMethodStats(payments) {
            const methodStats = {};
            payments.forEach(p => {
                if (p.paymentMethod) {
                    methodStats[p.paymentMethod] = (methodStats[p.paymentMethod] || 0) + 1;
                }
            });
            
            return Object.entries(methodStats)
                .sort((a, b) => b[1] - a[1])
                .map(([method, count]) => `${method}: ${count} times`)
                .join('\n') || 'No payment method data';
        }

        function getDeliveryTypeStats(payments) {
            const typeStats = {};
            payments.forEach(p => {
                const type = p.deliveryType || 'Standard';
                typeStats[type] = (typeStats[type] || 0) + 1;
            });
            
            return Object.entries(typeStats)
                .sort((a, b) => b[1] - a[1])
                .map(([type, count]) => `${type}: ${count} parcels`)
                .join('\n') || 'No delivery type data';
        }

        function getMostFrequentRoute(payments) {
            const routes = {};
            payments.forEach(p => {
                const route = `${p.senderCity} ‚Üí ${p.receiverCity}`;
                routes[route] = (routes[route] || 0) + 1;
            });
            
            const mostFrequent = Object.entries(routes).sort((a, b) => b[1] - a[1])[0];
            return mostFrequent ? `${mostFrequent[0]} (${mostFrequent[1]} times)` : 'N/A';
        }

        function getUniqueRoutesCount(payments) {
            const routes = new Set();
            payments.forEach(p => {
                routes.add(`${p.senderCity} ‚Üí ${p.receiverCity}`);
            });
            return routes.size;
        }

        function makePaymentForParcel(parcelId) {
            const parcel = api.parcels.find(p => p.id === parcelId);
            if (!parcel) return;
            
            showPage('payment');
            
            // Update payment summary
            document.querySelector('.payment-summary').innerHTML = `
                <h4 style="margin: 0 0 16px 0; color: #212121;">Payment Details</h4>
                <div class="payment-item">
                    <span>Parcel ${parcel.id} (${parcel.senderCity} ‚Üí ${parcel.receiverCity})</span>
                    <span>‚Çπ${parcel.cost}</span>
                </div>
                <div class="payment-total">
                    <span>Total Amount:</span>
                    <span>‚Çπ${parcel.cost}</span>
                </div>
            `;
            
            // Store parcel ID for processing
            window.currentPaymentParcelId = parcelId;
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            if (api.isAdmin) {
                showPage('adminDashboard');
                loadAdminDashboard();
            } else if (currentUser) {
                showLoggedInState();
                notificationManager = new NotificationManager();
                showPage('dashboard');
            }
            updateNavigation('home');
            
            // Initialize price calculator surge pricing
            priceCalculator.updateSurgeMultiplier();
            setInterval(() => priceCalculator.updateSurgeMultiplier(), 3600000); // Update hourly
            
            // Initialize bulk booking
            renderBulkParcels();
            
            // Initialize live chat
            initializeLiveChat();
        });

        function showPage(pageId) {
            // Hide all pages
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Load data for specific pages
            if (pageId === 'myQueries') {
                loadUserQueries();
            } else if (pageId === 'analytics') {
                loadAnalytics();
            } else if (pageId === 'savedAddresses') {
                loadSavedAddresses();
            } else if (pageId === 'bulkBooking') {
                renderBulkParcels();
            } else if (pageId === 'liveSupport') {
                renderLiveChatMessages();
            } else if (pageId === 'profile') {
                loadProfile();
            } else if (pageId === 'paymentHistory') {
                loadPaymentHistory();
            } else if (pageId === 'customerQuery' && !currentUser) {
                showNotification('Please login to report an issue', 'error');
                showPage('login');
                return;
            }
            
            // Update navigation
            updateNavigation(pageId);
        }

        function updateNavigation(pageId) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
        }

        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const userMenu = document.querySelector('.user-menu');
            if (userMenu && !userMenu.contains(event.target)) {
                document.getElementById('userDropdown').classList.remove('show');
            }
        });

        function handleSignup(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const name = formData.get('name');
            const email = formData.get('email');
            const phone = formData.get('phone');
            const city = formData.get('city');
            const password = formData.get('password');
            
            // Validate email
            if (!FormValidator.validateEmail(email)) {
                showNotification('Please enter a valid email address', 'error');
                FormValidator.showFieldError('signupEmail', 'Invalid email format');
                return;
            }
            
            // Validate phone
            if (!FormValidator.validatePhone(phone)) {
                showNotification('Please enter a valid 10-digit phone number', 'error');
                FormValidator.showFieldError('signupPhone', 'Invalid phone number');
                return;
            }
            
            // Check if user already exists
            if (users.find(u => u.email === email)) {
                showNotification('Email already registered! Please login instead.', 'error');
                return;
            }
            
            // Create new user
            const newUser = {
                id: Date.now(),
                name: name,
                email: email,
                phone: phone,
                city: city,
                password: password,
                joinDate: new Date().toISOString()
            };
            
            users.push(newUser);
            currentUser = newUser;
            api.users = users;
            api.currentUser = currentUser;
            api.saveAllData();
            
            // Update UI
            showLoggedInState();
            showNotification('Account created successfully! Welcome to DIGI POST!', 'success');
            showPage('dashboard');
            
            // Initialize notification manager
            notificationManager = new NotificationManager();
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                api.currentUser = currentUser;
                api.saveAllData();
                
                showLoggedInState();
                showNotification('Login successful! Welcome back!', 'success');
                showPage('dashboard');
                
                // Initialize notification manager
                notificationManager = new NotificationManager();
            } else {
                showNotification('Invalid email or password!', 'error');
            }
        }

        function showLoggedInState() {
            // Update menu
            document.getElementById('userMenuText').textContent = currentUser.name.split(' ')[0];
            document.getElementById('loginLink').classList.add('hidden');
            document.getElementById('signupLink').classList.add('hidden');
            document.getElementById('dashboardLink').classList.remove('hidden');
            document.getElementById('profileLink').classList.remove('hidden');
            document.getElementById('profileLink').onclick = function(e) {
                e.preventDefault();
                showPage('profile');
                loadProfile();
            };
            document.getElementById('logoutLink').classList.remove('hidden');
            
            // Update dashboard stats
            updateDashboardStats();
        }

        function logout() {
            currentUser = null;
            api.currentUser = null;
            api.saveAllData();
            
            // Update menu
            document.getElementById('userMenuText').textContent = 'Account';
            document.getElementById('loginLink').classList.remove('hidden');
            document.getElementById('signupLink').classList.remove('hidden');
            document.getElementById('dashboardLink').classList.add('hidden');
            document.getElementById('profileLink').classList.add('hidden');
            document.getElementById('logoutLink').classList.add('hidden');
            
            // Remove notification bell
            const bellContainer = document.querySelector('.header-actions > div');
            if (bellContainer && bellContainer.querySelector('.notification-badge')) {
                bellContainer.remove();
            }
            
            showNotification('Logged out successfully!', 'success');
            showPage('home');
        }

        function updateDashboardStats() {
            if (!currentUser) return;
            
            const userParcels = parcels.filter(p => p.userId === currentUser.id);
            const activeDeliveries = userParcels.filter(p => p.status !== 'Delivered').length;
            const deliveredParcels = userParcels.filter(p => p.status === 'Delivered').length;
            
            document.getElementById('totalParcels').textContent = userParcels.length;
            document.getElementById('activeDeliveries').textContent = activeDeliveries;
            document.getElementById('deliveredParcels').textContent = deliveredParcels;
        }

        function calculatePrice() {
            const weight = parseFloat(document.getElementById('parcelWeight').value) || 0;
            const deliveryType = document.getElementById('deliveryType').value;
            const isFragile = document.getElementById('fragileItem').checked;
            
            if (!weight || !deliveryType) {
                document.getElementById('estimatedCost').textContent = '‚Çπ0';
                document.getElementById('baseCharge').textContent = '‚Çπ0';
                document.getElementById('weightCharge').textContent = '‚Çπ0';
                return;
            }
            
            let baseCharge = 0;
            if (deliveryType === 'standard') baseCharge = 50;
            else if (deliveryType === 'express') baseCharge = 100;
            else if (deliveryType === 'same-day') baseCharge = 200;
            
            const weightCharge = weight > 1 ? (weight - 1) * 20 : 0;
            const fragileCharge = isFragile ? 50 : 0;
            const totalCost = baseCharge + weightCharge + fragileCharge;
            
            document.getElementById('baseCharge').textContent = `‚Çπ${baseCharge + fragileCharge}`;
            document.getElementById('weightCharge').textContent = `‚Çπ${weightCharge}`;
            document.getElementById('estimatedCost').textContent = `‚Çπ${totalCost}`;
        }

        function handleBooking(event) {
            event.preventDefault();
            
            if (!currentUser) {
                showNotification('Please login to book a parcel', 'error');
                showPage('login');
                return;
            }
            
            const formData = new FormData(event.target);
            const messageToRecipient = formData.get('messageToRecipient')?.trim() || null;
            
            const newParcel = {
                id: 'DP' + String(Date.now()).slice(-6),
                userId: currentUser.id,
                senderName: formData.get('senderName'),
                senderPhone: formData.get('senderPhone'),
                senderAddress: formData.get('senderAddress'),
                senderCity: formData.get('senderCity'),
                receiverName: formData.get('receiverName'),
                receiverPhone: formData.get('receiverPhone'),
                receiverAddress: formData.get('receiverAddress'),
                receiverCity: formData.get('receiverCity'),
                weight: formData.get('parcelWeight'),
                type: formData.get('parcelType'),
                deliveryType: formData.get('deliveryType'),
                messageToRecipient: messageToRecipient,
                status: 'Processing',
                bookingDate: new Date().toISOString(),
                cost: parseInt(document.getElementById('estimatedCost').textContent.replace('‚Çπ', ''))
            };
            
            parcels.push(newParcel);
            api.parcels = parcels;
            api.saveAllData();
            
            // Add notification
            api.addNotification(currentUser.id, `Your parcel ${newParcel.id} has been booked successfully!`);
            api.saveAllData();
            
            // Reset form
            document.getElementById('bookingForm').reset();
            document.getElementById('estimatedCost').textContent = '‚Çπ0';
            
            const successMessage = messageToRecipient 
                ? `Parcel booked successfully! Your personal message will be delivered with the parcel.`
                : `Parcel booked successfully!`;
            
            showNotification(successMessage, 'success');
            showPage('tracking');
            
            // Auto-fill tracking number
            document.getElementById('trackingNumber').value = newParcel.id;
            handleTracking({ preventDefault: () => {} });
            
            // Update dashboard stats
            updateDashboardStats();
            
            // Rebuild search index
            searchEngine.buildSearchIndex();
        }

        function handleTracking(event) {
            event.preventDefault();
            
            const trackingNumber = document.getElementById('trackingNumber').value.trim();
            const parcel = parcels.find(p => p.id === trackingNumber);
            
            if (!parcel) {
                showNotification('Parcel not found! Please check your tracking number.', 'error');
                document.getElementById('trackingResult').style.display = 'none';
                return;
            }
            
            // Show tracking result
            document.getElementById('trackingId').textContent = `Tracking ID: ${parcel.id}`;
            
            let statusClass = 'status-processing';
            if (parcel.status === 'In Transit' || parcel.status === 'Picked Up') statusClass = 'status-transit';
            if (parcel.status === 'Delivered') statusClass = 'status-delivered';
            
            const statusBadge = document.getElementById('trackingStatus');
            statusBadge.textContent = parcel.status;
            statusBadge.className = `status-badge ${statusClass}`;
            
            // Show parcel details
            const detailsHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                    <div>
                        <strong>From:</strong> ${parcel.senderCity}<br>
                        <span style="font-size: 14px; color: #696969;">${parcel.senderName}</span>
                    </div>
                    <div>
                        <strong>To:</strong> ${parcel.receiverCity}<br>
                        <span style="font-size: 14px; color: #696969;">${parcel.receiverName}</span>
                    </div>
                    <div>
                        <strong>Weight:</strong> ${parcel.weight} kg
                    </div>
                    <div>
                        <strong>Type:</strong> ${parcel.type}
                    </div>
                </div>
                ${parcel.messageToRecipient ? `
                    <div style="background: #e3f2fd; padding: 12px; border-radius: 4px; margin-bottom: 24px; border-left: 4px solid #2196f3;">
                        <strong>üí¨ Message to Recipient:</strong>
                        <div style="margin-top: 8px; font-style: italic; color: #1976d2;">"${parcel.messageToRecipient}"</div>
                    </div>
                ` : ''}
            `;
            document.getElementById('trackingDetails').innerHTML = detailsHTML;
            
            // Show timeline
            const timelineHTML = `
                <div class="timeline">
                    <div class="timeline-item ${parcel.status === 'Processing' || parcel.status === 'Picked Up' || parcel.status === 'In Transit' || parcel.status === 'Out for Delivery' || parcel.status === 'Delivered' ? 'completed' : ''}">
                        <div class="timeline-title">Order Placed</div>
                        <div class="timeline-time">${new Date(parcel.bookingDate).toLocaleString()}</div>
                    </div>
                    <div class="timeline-item ${parcel.status === 'Picked Up' || parcel.status === 'In Transit' || parcel.status === 'Out for Delivery' || parcel.status === 'Delivered' ? 'completed' : parcel.status === 'Processing' ? 'active' : ''}">
                        <div class="timeline-title">Processing</div>
                        <div class="timeline-time">${parcel.status === 'Processing' ? 'In progress' : 'Completed'}</div>
                    </div>
                    <div class="timeline-item ${parcel.status === 'In Transit' || parcel.status === 'Out for Delivery' || parcel.status === 'Delivered' ? 'completed' : parcel.status === 'Picked Up' ? 'active' : ''}">
                        <div class="timeline-title">Picked Up</div>
                        <div class="timeline-time">${parcel.status === 'Picked Up' ? 'In progress' : parcel.status === 'In Transit' || parcel.status === 'Out for Delivery' || parcel.status === 'Delivered' ? 'Completed' : 'Pending'}</div>
                    </div>
                    <div class="timeline-item ${parcel.status === 'Out for Delivery' || parcel.status === 'Delivered' ? 'completed' : parcel.status === 'In Transit' ? 'active' : ''}">
                        <div class="timeline-title">In Transit</div>
                        <div class="timeline-time">${parcel.status === 'In Transit' ? 'In progress' : parcel.status === 'Out for Delivery' || parcel.status === 'Delivered' ? 'Completed' : 'Pending'}</div>
                    </div>
                    <div class="timeline-item ${parcel.status === 'Delivered' ? 'completed' : parcel.status === 'Out for Delivery' ? 'active' : ''}">
                        <div class="timeline-title">Out for Delivery</div>
                        <div class="timeline-time">${parcel.status === 'Out for Delivery' ? 'In progress' : parcel.status === 'Delivered' ? 'Completed' : 'Pending'}</div>
                    </div>
                    <div class="timeline-item ${parcel.status === 'Delivered' ? 'completed active' : ''}">
                        <div class="timeline-title">Delivered</div>
                        <div class="timeline-time">${parcel.status === 'Delivered' ? 'Completed' : 'Pending'}</div>
                    </div>
                </div>
            `;
            document.getElementById('trackingTimeline').innerHTML = timelineHTML;
            
            document.getElementById('trackingResult').style.display = 'block';
        }

        function showPaymentMethod() {
            // Hide all payment methods
            document.querySelectorAll('.payment-method').forEach(method => {
                method.classList.remove('active');
            });
            
            // Show selected method
            const selectedMethod = document.getElementById('paymentMethod').value;
            if (selectedMethod) {
                document.getElementById(selectedMethod + 'Payment').classList.add('active');
            }
        }

        function processPayment() {
            const paymentMethod = document.getElementById('paymentMethod').value;
            
            if (!paymentMethod) {
                showNotification('Please select a payment method', 'error');
                return;
            }
            
            showNotification('Processing payment...', 'info');
            
            setTimeout(() => {
                // Update parcel payment status if paying for specific parcel
                if (window.currentPaymentParcelId) {
                    const parcel = api.parcels.find(p => p.id === window.currentPaymentParcelId);
                    if (parcel) {
                        parcel.paymentCompleted = true;
                        parcel.paymentDate = new Date().toISOString();
                        parcel.paymentMethod = getPaymentMethodName(paymentMethod);
                        parcel.transactionId = 'TXN' + Date.now();
                        api.saveAllData();
                    }
                    window.currentPaymentParcelId = null;
                }
                
                showNotification('Payment successful! Thank you for using DIGI POST!', 'success');
                
                // Redirect to payment history to show receipt
                setTimeout(() => {
                    showPage('paymentHistory');
                    loadPaymentHistory();
                }, 1000);
            }, 2000);
        }
        
        function getPaymentMethodName(method) {
            const names = {
                'qr': 'QR Code / UPI',
                'card': 'Credit/Debit Card',
                'upi': 'UPI',
                'netbanking': 'Net Banking'
            };
            return names[method] || method;
        }

        // Chatbot Functions
        function toggleChatbot() {
            const chatbot = document.getElementById('chatbot');
            chatbot.classList.toggle('show');
            
            if (chatbot.classList.contains('show')) {
                document.getElementById('chatInput').focus();
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage('user', message);
            input.value = '';
            
            // Simulate bot response
            setTimeout(() => {
                const response = getBotResponse(message);
                addChatMessage('bot', response);
            }, 1000);
        }

        function handleChatKeypress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function addChatMessage(sender, message) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.innerHTML = `<div class="message-content">${message}</div>`;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function getBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('track') || lowerMessage.includes('status')) {
                return 'You can track your parcel by going to the Track Parcel page and entering your tracking number. Would you like me to take you there?';
            } else if (lowerMessage.includes('book') || lowerMessage.includes('send')) {
                return 'To book a parcel, please visit our Book Parcel page. You\'ll need to provide sender and receiver details. The process is quick and easy!';
            } else if (lowerMessage.includes('price') || lowerMessage.includes('cost')) {
                return 'Our pricing starts at ‚Çπ50 for standard delivery (3-5 days), ‚Çπ100 for express delivery (1-2 days), and ‚Çπ200 for same-day delivery. Additional charges apply based on weight.';
            } else if (lowerMessage.includes('payment') || lowerMessage.includes('pay')) {
                return 'We accept multiple payment methods including UPI, credit/debit cards, net banking, and QR code payments. You can pay online securely through our payment gateway.';
            } else if (lowerMessage.includes('contact') || lowerMessage.includes('support')) {
                return 'You can reach our customer support at 1800-DIGI-POST or email us at support@digipost.com. We\'re available 24/7 to help you!';
            } else if (lowerMessage.includes('delivery') || lowerMessage.includes('time')) {
                return 'Standard delivery takes 3-5 days, express delivery takes 1-2 days, and same-day delivery is available in major cities. Delivery times may vary based on location.';
            } else if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                return 'Hello! How can I assist you with your parcel delivery needs today?';
            } else if (lowerMessage.includes('thank')) {
                return 'You\'re welcome! Is there anything else I can help you with?';
            } else {
                return 'I\'m here to help! You can ask me about tracking parcels, booking shipments, pricing, payment methods, or delivery times. What would you like to know?';
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 24px;
                background: ${type === 'success' ? '#4caf50' : type === 'error' ? '#f44336' : '#2196f3'};
                color: white;
                padding: 16px 24px;
                border-radius: 4px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
                max-width: 400px;
            `;
            
            const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úï' : '‚Ñπ';
            notification.innerHTML = `<strong>${icon}</strong> ${message}`;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Add animation styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9aa82e5804f86091',t:'MTc2NTE1NDEwOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>